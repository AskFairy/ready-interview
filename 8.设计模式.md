# 设计模式

任何一种设计模式有时候都不是单独使用的，需要结合其他模式共同建设 

## 行为模式

负责对象间的高效沟通和职责委派

### 观察者

#### 什么是观察者模式？

定义了对象间一对多的依赖关系，当一个对象的状态发生改变时，用消息通知依赖于它的对象做出相应处理。

在实际业务中一般用来拆分核心流程和辅助流程，一般业务的核心流程不会经常变化，但辅助流程可能会随着业务的扩展，出现各种变化。拆分后，使系统低耦合的同时也增强了扩展性。

但又因为没有直接的耦合关联，可能控制不了依赖对象的调用顺序以及对依赖对象的返回结果继续操作。

#### 业务实践

##### 模型架构

![img](https://gitee.com//chenchong0817/picture/raw/master/https://gitee.com/chenchong0817/picture/20200906174815.png)

##### 工程结构

![img](https://gitee.com//chenchong0817/picture/raw/master/https://gitee.com/chenchong0817/picture/20200906174906.png)

##### 流程思想

主要分为：事件监听、事件处理、具体的业务流程三部分

`事件监听`，主要是定义事件监听接口，和监听到事件后的具体实现。（一对多中的多）

`事件处理`类，主要是维护事件列表，并对事件列表进行`订阅`、`删除`、以及`通知`事件监听干活的功能（耦合）。

具体的`业务流程`在业务抽象类中，业务抽象类只关心完成主业务功能后怎么调用辅助功能。提供主业务功能的抽象接口，让业务实现类具体实现（一对多中的一），使用时调用业务抽象类就可以了。

### 状态

#### 什么是状态模式？

允许对象在内部状态发生改变时改变它的行为，也就是说通过改变**状态**，而让对象的行为发生了变化。比如我们最常见的一个网站的页面，在你登录与不登录下展示的内容是略有差异。或者说在审批流中，审批对象状态的改变，导致对象后续行为的不同。但需要考虑的是，如果状态较多，就会产生较多的实现类，主要点在于看是否经常修改、是否可以做成组件化、抽离业务与非业务功能。

#### 业务实践

##### 工程模式

![image-20200908002418422](https://gitee.com//chenchong0817/picture/raw/master/Aaron/20200908002420.png)

##### 模型架构

![img](https://bugstack.cn/assets/images/2020/itstack-demo-design-19-04.png)

##### 流程思想

​	先定义状态抽象类，提供更改状态后的流转服务（需要做什么的）接口。

​	每种状态流转服务的具体实现: 状态更改后需要做哪些能做，有些不能做。

​	状态处理类：

- 在构造函数中提供了所有状态和实现的具体关联，放到Map数据结构中。
- 提供了不同名称的接口操作类，让外部调用方可以更加容易的使用此项功能接口。只需要提供流程对象唯一标识，和当前状态代码就可以。

### 策略模式

#### 什么是策略模式？

策略模式针对一组具有相同目的的算法，将每一个算法封装到具有共同接口的独立的类中，从而使得它们可以相互替换。

策略模式使得算法可以在不影响到`客户端（调用者）`的情况下发生变化。策略模式把行为和环境分开，`环境类（策略控制器）`负责维持和查询行为类，各种算法在具体的策略类中提供。由于算法和环境独立开来，算法的增减，修改都不会影响到环境和客户端。

业务场景：一般是具有同类可替代的行为逻辑算法场景（相同目的的算法，互相替代）。

- 不同类型的交易方式(信用卡、支付宝、微信)
- 生成唯一ID策略(UUID、DB自增、DB+Redis、雪花算法、Leaf算法)等，都可以使用策略模式进行行为包装，供给外部使用。
- 模拟在购买商品时候使用的各种类型优惠券(满减、直减、折扣、n元购)

#### 业务实践

#### 工程模式

![image-20200910232850992](https://gitee.com//chenchong0817/picture/raw/master/Aaron/20200910232853.png)

#### 模型架构

![image-20200910232926455](https://gitee.com//chenchong0817/picture/raw/master/Aaron/20200910232928.png)

#### 流程思想

- 将相同目的算法抽象出一个`公共的接口`，可以增加泛型用于不同类型的接口可以传递不同的类型参数。
- 算法接口的具体实现。
- 策略控制类主要是外部可以通过构造函数透传不同的策略实现或者通过Map存放Key和服务，在通过统一的方法执行优惠策略计算。



# 问题

### 状态模式与命令模式、适配器模式结构相似，的思路差异和各种的逻辑特点？

### 状态模式配合装饰者实现优惠叠加？





# 资料

[23种设计模式的趣说详解](https://blog.csdn.net/softwave/article/details/1750101)