### 基础

#### 数据库的三范式是什么？什么是反模式？

1. 原子性
2. 完全依赖主键
3. 直接依赖于主键

表多，join，性能

反设计模式：宽表

#### Mysql数据类型

#### varchar 则是一种可变长度的类型，（50）排序占内存少

#### int(11) 中的 11影响展示效果

#### 金钱decimal 

#### 自增主键，InnoDB类型重启丢失，MyISAM 类型记录不丢失

#### COUNT(*) ，InnoDB类型全表扫描，MyISAM 类型记录

#### InnoDB 的 [4 大特性](https://note.youdao.com/ynoteshare1/index.html?id=a6004953a0a7c80073ac74d8e76f1ebd&type=note)

- [插入缓冲](https://www.cnblogs.com/zhs0/p/10528520.html)(insert buffer/ change buffer) 
  - 非聚簇索引
  - 插入缓存，合并
  - 减少随机IO，提升性能
- 二次写(double write)
  - 写入磁盘之前，缓存，崩溃恢复
- 自适应哈希索引(ahi)
  - 监控热数据，自适应变成hash索引
- 预读(read ahead)：提升IO性能
  - 线性预读：阀值，默认56，下一个extent放入buffer pool
  - 随机预读：当前extent中剩余的page，5.5废弃

#### MySQL 存储引擎：

- `InnoDB`
- `MyISAM`
- MRG_MYISAM
- MEMORY

#### MyISAM和InnoDB

- 事物
- 锁
- 崩溃恢复
- MVCC应对高并发





#### 字符集指的是⼀种从**⼆进制编码**到某类**字符符号**的**映射**。校对规则则是指某种**字符集下**的**排序规则**。



![image-20200927201915956](https://gitee.com//chenchong0817/picture/raw/master/Aaron/20200927201926.png)



### 索引

#### 好处

- 缩小查询数目，加快检索速度，降低IO成本
- 数据预先排好序，排序成本、CPU消耗

#### 坏处

- 占用存储空间
- 降低更新表的速度

#### 场景

- 中大型表
- 特大型的表，建立和使用索引的代价随着增长，建议**分库分表**

#### 索引类型

- 1、普通索引
- 2、唯一索引
- 3、主键索引
- 4、复合索引
- 5、外键索引
- 6、全文索引

#### **创建**原则

1.  `WHERE` 子句中的列，或连接子句中的列
2. **基数越大**，索引效果越好
3. 创建**复合索引，基数更大**
4. 避免**创建过多**的索引，**占空间，降低写效率**
5. **主键**尽可能**选择较短**的数据类型，可以有效**减少索引的磁盘**占用提高查询效率。
6. 对字符串进行索引，应该定制一个前缀长度，可以节省大量的索引空间。

#### **使用**注意事项

- 1、避免在 `WHERE` 子句中使用 `!=` 或 `<>` 、`column IS NULL`  `OR`，否则将引擎放弃使用索引而进行**全表扫描**。优化器将**无法通过索引来确定将要命中的行数**,因此需要搜索该表的所有行。
- 3、应尽量避免在 `WHERE` 子句中**对字段进行表达式、函数操作**，这将导致引擎放弃使用索引而进行全表扫描。
- 5、不要在 `WHERE` 子句中的 `=` 左边进行函数、算术运算或其他表达式运算，否则系统将可能无法正确使用索引。
- 6、复合索引**遵循前缀原则**。
- 7、如果 MySQL 评估使用索引比全表扫描更慢，会放弃使用索引。如果此时想要索引，可以在语句中**添加强制索引**。
- 8、列类型是**字符串类型**，查询时一定要给值**加引号**，否则索引失效。
- 9、`LIKE` 查询，`%` 不能在前，因为无法使用索引。如果需要模糊匹配，可以使用全文索引。

####  以下三条 SQL 如何建索引，只建一条怎么建？

```
WHERE a = 1 AND b = 1
WHERE b = 1
WHERE b = 1 ORDER BY time DESC
```

- 以顺序 b , a, time 建立复合索引，`CREATE INDEX table1_b_a_time ON index_test01(b, a, time)`。
- 对于第一条 **SQL** ，因为最新 MySQL 版本会**优化** `WHERE` 子句后面的列顺序，以匹配复合索引顺序。

#### （重点）EXPLAIN

详细看看 [《MySQL explain 执行计划详细解释》](http://www.jfox.info/2017/mysql-explain执行计划详细解释.html) 。

#### 索引原理

读取基本单位  page  16k



#### 资料

http://blog.codinglabs.org/articles/theory-of-mysql-index.html