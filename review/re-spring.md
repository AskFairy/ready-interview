# Spring æ•´ä½“

## ä»€ä¹ˆæ˜¯ Spring Frameworkï¼Ÿ

Spring æ˜¯ä¸€ä¸ª**è½»é‡çº§**çš„**å¼€æº**åº”ç”¨æ¡†æ¶ï¼Œ**é™ä½åº”ç”¨ç¨‹åºå¼€å‘çš„å¤æ‚åº¦ï¼Œå¯ä»¥é›†æˆå…¶ä»–æ¡†æ¶**ã€‚

## Spring Framework ä¸­æœ‰å¤šå°‘ä¸ªæ¨¡å—ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ

[![Spring Framework](http://static2.iocoder.cn/images/Spring/2018-12-24/01.jpg)](http://static2.iocoder.cn/images/Spring/2018-12-24/01.jpg)

**1ã€Spring coreï¼šæ ¸å¿ƒå®¹å™¨**

æ ¸å¿ƒå®¹å™¨æä¾›springæ¡†æ¶çš„**åŸºæœ¬åŠŸèƒ½**ã€‚ä¸»è¦å®ç°æ§åˆ¶åè½¬IoCå’Œä¾èµ–æ³¨å…¥DIã€Beané…ç½®ä»¥åŠåŠ è½½ã€‚

**2ã€Spring AOPï¼šSpringé¢å‘åˆ‡é¢ç¼–ç¨‹**

é€šè¿‡é…ç½®ç®¡ç†ç‰¹æ€§ï¼ŒSpring AOP æ¨¡å—ç›´æ¥å°†é¢å‘åˆ‡é¢é¢çš„ç¼–ç¨‹åŠŸèƒ½é›†æˆåˆ°äº†Springæ¡†æ¶ä¸­ã€‚

**3ã€Spring contextï¼šSpringä¸Šä¸‹æ–‡**

Springä¸Šä¸‹æ–‡æ˜¯ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå‘Springæ¡†æ¶æä¾›ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚

**4ã€Spring DAO**

DAOæ¨¡å—ä¸»è¦ç›®çš„æ˜¯å°†æŒä¹…å±‚ç›¸å…³é—®é¢˜ä¸ä¸€èˆ¬çš„çš„ä¸šåŠ¡è§„åˆ™å’Œå·¥ä½œæµéš”ç¦»å¼€æ¥ã€‚Spring ä¸­çš„DAOæä¾›ä¸€è‡´çš„æ–¹å¼è®¿é—®æ•°æ®åº“ï¼Œä¸ç®¡é‡‡ç”¨ä½•ç§æŒä¹…åŒ–æŠ€æœ¯ï¼ŒSpringéƒ½æä¾›ä¸€è‡´çš„ç¼–ç¨‹æ¨¡å‹ã€‚

**5ã€Spring ORMï¼ˆObject Relation Mapperï¼‰å¯¹è±¡å…³ç³»æ˜ å°„æ¨¡å—**

ORMæ˜¯é€šè¿‡ä½¿ç”¨æè¿°å¯¹è±¡å’Œæ•°æ®åº“ä¹‹é—´æ˜ å°„çš„å…ƒæ•°æ®ï¼ŒORMæ¡†æ¶é‡‡ç”¨å…ƒæ•°æ®æ¥æè¿°å¯¹è±¡--å…³ç³»æ˜ å°„ç»†èŠ‚ï¼Œå…ƒæ•°æ®ä¸€èˆ¬é‡‡ç”¨xmlæ ¼å¼ï¼Œå¹¶ä¸”å­˜æ”¾åœ¨ä¸“é—¨çš„å¯¹è±¡--æ˜ å°„æ–‡ä»¶ä¸­

**6ã€Spring Webæ¨¡å—**

Webæ¨¡å—å»ºç«‹åœ¨åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡æ¨¡å—ä¹‹ä¸Šï¼Œä¸ºåŸºäºWebçš„åº”ç”¨ç¨‹åºæä¾›äº†ä¸Šä¸‹æ–‡ã€‚Webå±‚ä½¿ç”¨Webå±‚æ¡†æ¶ï¼Œå¯é€‰çš„ï¼Œå¯ä»¥æ˜¯Springè‡ªå·±çš„MVCæ¡†æ¶ï¼Œæˆ–è€…æä¾›çš„Webæ¡†æ¶ï¼Œå¦‚Strutsç­‰ã€‚

**7ã€Spring MVC**

MVCæ¡†æ¶æ˜¯ä¸€ä¸ªå…¨åŠŸèƒ½çš„æ„å»ºWebåº”ç”¨ç¨‹åºçš„MVCå®ç°ã€‚

### ï¼ˆé‡ç‚¹ï¼‰Spring MVC çš„å·¥ä½œæµç¨‹

- ï¼ˆ1ï¼‰ å®¢æˆ·ç«¯å‘é€è¯·æ±‚ï¼Œè¯·æ±‚åˆ°è¾¾ DispatcherServlet ä¸»æ§åˆ¶å™¨ã€‚
  ï¼ˆ2ï¼‰ DispatcherServlet æ§åˆ¶å™¨è°ƒç”¨ HandlerMapping å¤„ç†ã€‚
  ï¼ˆ3ï¼‰ HandlerMapping è´Ÿè´£ç»´æŠ¤è¯·æ±‚å’Œ Controller ç»„ä»¶å¯¹åº”å…³ç³»ã€‚ HandlerMapping æ ¹æ®è¯·æ±‚è°ƒç”¨å¯¹åº”çš„ Controller ç»„ä»¶å¤„ç†ã€‚
  ï¼ˆ4ï¼‰ æ‰§è¡Œ Controller ç»„ä»¶çš„ä¸šåŠ¡å¤„ç†ï¼Œéœ€è¦è®¿é—®æ•°æ®åº“ï¼Œå¯ä»¥è°ƒç”¨ DAO ç­‰ç»„ä»¶ã€‚
  ï¼ˆ5ï¼‰Controller ä¸šåŠ¡æ–¹æ³•å¤„ç†å®Œæ¯•åï¼Œä¼šè¿”å›ä¸€ä¸ª ModelAndView å¯¹è±¡ã€‚è¯¥ç»„ä»¶å°è£…äº†æ¨¡å‹æ•°æ®å’Œè§†å›¾æ ‡è¯†ã€‚
  ï¼ˆ6ï¼‰Servlet ä¸»æ§åˆ¶å™¨è°ƒç”¨ ViewResolver ç»„ä»¶ï¼Œæ ¹æ® ModelAndView ä¿¡æ¯å¤„ç†ã€‚å®šä½è§†å›¾èµ„æºï¼Œç”Ÿæˆè§†å›¾å“åº”ä¿¡æ¯ã€‚
  ï¼ˆ7ï¼‰æ§åˆ¶å™¨å°†å“åº”ä¿¡æ¯ç»™ç”¨æˆ·è¾“å‡ºã€‚



## ï¼ˆé‡ç‚¹ï¼‰ä½¿ç”¨ Spring æ¡†æ¶èƒ½å¸¦æ¥å“ªäº›å¥½å¤„ï¼Ÿ



- **DI** ï¼š**[Dependency Injection(DI)](http://howtodoinjava.com/2013/03/19/inversion-of-control-ioc-and-dependency-injection-di-patterns-in-spring-framework-and-related-interview-questions/)** æ–¹æ³•ï¼Œä½¿å¾—æ„é€ å™¨å’Œ JavaBeanã€properties æ–‡ä»¶ä¸­çš„ä¾èµ–å…³ç³»ä¸€ç›®äº†ç„¶ã€‚
- **è½»é‡çº§**ï¼šä¸ EJB å®¹å™¨ç›¸æ¯”è¾ƒï¼Œ**IoC å®¹å™¨æ›´åŠ è¶‹å‘äºè½»é‡çº§**ã€‚è¿™æ ·ä¸€æ¥ IoC å®¹å™¨åœ¨æœ‰é™çš„å†…å­˜å’Œ CPU èµ„æºçš„æƒ…å†µä¸‹ï¼Œè¿›è¡Œåº”ç”¨ç¨‹åºçš„å¼€å‘å’Œå‘å¸ƒå°±å˜å¾—ååˆ†æœ‰åˆ©ã€‚
- **é¢å‘åˆ‡é¢ç¼–ç¨‹(AOP)**ï¼š Spring æ”¯æŒé¢å‘**åˆ‡é¢ç¼–ç¨‹**ï¼ŒåŒæ—¶æŠŠåº”ç”¨çš„ä¸šåŠ¡é€»è¾‘ä¸ç³»ç»Ÿçš„æœåŠ¡åˆ†ç¦»å¼€æ¥ã€‚
- **é›†æˆä¸»æµæ¡†æ¶**ï¼š
- **Web æ¡†æ¶**ï¼šSpring çš„ **Web æ¡†æ¶**äº¦æ˜¯ä¸€ä¸ªç²¾å¿ƒè®¾è®¡çš„ Web MVC æ¡†æ¶
- **äº‹åŠ¡ç®¡ç†**ï¼šé€‚ç”¨äºå°å‹çš„æœ¬åœ°äº‹ç‰©å¤„ç†ï¼ˆæ¯”å¦‚åœ¨å• DB çš„ç¯å¢ƒä¸‹ï¼‰
- **å¼‚å¸¸å¤„ç†**

å¸¦æ¥ç›¸åº”çš„ç¼ºç‚¹ï¼š

- æŠŠå¾ˆå¤š JavaEE çš„ä¸œè¥¿å°è£…äº†ï¼Œåœ¨æ»¡è¶³å¿«é€Ÿå¼€å‘é«˜è´¨é‡ç¨‹åºçš„åŒæ—¶ï¼Œ**éšè—äº†å®ç°ç»†èŠ‚**ã€‚


## ï¼ˆé‡ç‚¹ï¼‰Spring æ¡†æ¶ä¸­éƒ½ç”¨åˆ°äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ

Spring æ¡†æ¶ä¸­ä½¿ç”¨åˆ°äº†å¤§é‡çš„è®¾è®¡æ¨¡å¼ï¼Œä¸‹é¢åˆ—ä¸¾äº†æ¯”è¾ƒæœ‰ä»£è¡¨æ€§çš„ï¼š

- **ä»£ç†æ¨¡å¼** â€” åœ¨ `AOP` ä¸­è¢«ç”¨çš„æ¯”è¾ƒå¤šã€‚
- **å•ä¾‹æ¨¡å¼** â€” åœ¨ Spring é…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„ **Bean é»˜è®¤ä¸ºå•ä¾‹æ¨¡å¼**ã€‚
- **æ¨¡æ¿æ–¹æ³•** â€” ç”¨æ¥è§£å†³ä»£ç é‡å¤çš„é—®é¢˜ã€‚æ¯”å¦‚ [RestTemplate](http://howtodoinjava.com/2015/02/20/spring-restful-client-resttemplate-example/)ã€JmsTemplateã€JdbcTemplate ã€‚
- **å·¥å‚æ¨¡å¼ã€æŠ½è±¡å·¥å‚æ¨¡å¼** â€” BeanFactory ç”¨æ¥åˆ›å»ºå¯¹è±¡çš„å®ä¾‹ã€‚

å½“ç„¶ï¼Œæ„Ÿå…´è¶£çš„èƒ–å‹ï¼Œè§‰å¾—ä¸è¿‡ç˜¾ï¼Œå¯ä»¥çœ‹çœ‹è‰¿è‰¿åŸºå‹çŸ¥ç§‹å†™çš„å‡ ç¯‡æ–‡ç« ï¼š

- [ã€ŠSpring æ¡†æ¶ä¸­çš„è®¾è®¡æ¨¡å¼(ä¸€)ã€‹](http://www.iocoder.cn/Spring/DesignPattern-1)
- [ã€ŠSpring æ¡†æ¶ä¸­çš„è®¾è®¡æ¨¡å¼(äºŒ)ã€‹](http://www.iocoder.cn/Spring/DesignPattern-2)
- [ã€ŠSpring æ¡†æ¶ä¸­çš„è®¾è®¡æ¨¡å¼(ä¸‰)ã€‹](http://www.iocoder.cn/Spring/DesignPattern-3)
- [ã€ŠSpring æ¡†æ¶ä¸­çš„è®¾è®¡æ¨¡å¼(å››)ã€‹](http://www.iocoder.cn/Spring/DesignPattern-4)
- [ã€ŠSpring æ¡†æ¶ä¸­çš„è®¾è®¡æ¨¡å¼(äº”)ã€‹](http://www.iocoder.cn/Spring/DesignPattern-5)

# Spring IoC

## ä»€ä¹ˆæ˜¯ Spring IoC å®¹å™¨ï¼Ÿ



Spring æ¡†æ¶çš„æ ¸å¿ƒæ˜¯ Spring IoC å®¹å™¨ã€‚å®¹å™¨è¿‡è¯»å–æä¾›çš„**é…ç½®å…ƒæ•°æ®** Bean Definition **åˆ›å»º** Bean å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨**ä¾èµ–æ³¨å…¥**æ¥ç®¡ç†ç®¡ç†çš„**å®Œæ•´ç”Ÿå‘½å‘¨æœŸ**ã€‚

- è¯¥é…ç½®å…ƒæ•°æ® Bean Definition å¯ä»¥é€šè¿‡ `XML`ï¼ŒJava `æ³¨è§£`æˆ– `Java Config ä»£ç `**æä¾›**ã€‚

## ä»€ä¹ˆæ˜¯ä¾èµ–æ³¨å…¥ï¼Ÿ

å°±æ˜¯ä¸€ç§å°†è°ƒç”¨è€…ä¸è¢«è°ƒç”¨è€…åˆ†ç¦»çš„æ€æƒ³ï¼Œåœ¨ä¾èµ–æ³¨å…¥ä¸­ï¼Œä½ **ä¸å¿…ä¸»åŠ¨**ã€æ‰‹åŠ¨åˆ›å»ºå¯¹è±¡ï¼Œä½†**å¿…é¡»æè¿°**å¦‚ä½•åˆ›å»ºå®ƒä»¬ã€‚ç„¶åï¼Œå†ç”± IoC å®¹å™¨å°†å®ƒä»¬è£…é…åœ¨ä¸€èµ·ã€‚

## IoC å’Œ DI æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ



IoCæ˜¯ç›®çš„ï¼ŒDIæ˜¯æ‰‹æ®µã€‚IoCæ˜¯æŒ‡è®©ç”Ÿæˆç±»çš„æ–¹å¼ç”±ä¼ ç»Ÿæ–¹å¼ï¼ˆnewï¼‰åè¿‡æ¥ï¼Œæ—¢ç¨‹åºå‘˜ä¸è°ƒç”¨new,éœ€è¦ç±»çš„æ—¶å€™ç”±æ¡†æ¶æ³¨å…¥ï¼ˆDIï¼‰

## å¯ä»¥é€šè¿‡å¤šå°‘ç§æ–¹å¼å®Œæˆä¾èµ–æ³¨å…¥ï¼Ÿ

é€šå¸¸ï¼Œä¾èµ–æ³¨å…¥å¯ä»¥é€šè¿‡**ä¸‰ç§**æ–¹å¼å®Œæˆï¼Œå³ï¼š

> ä¸Šé¢ä¸€ä¸ªé—®é¢˜çš„ä¸‰ç§æ–¹å¼çš„è‹±æ–‡ï¼Œä¸‹é¢æ˜¯ä¸‰ç§æ–¹å¼çš„ä¸­æ–‡ã€‚

- æ¥å£æ³¨å…¥
- **æ„é€ å‡½æ•°æ³¨å…¥**
- **setter æ³¨å…¥**

| æ„é€ å‡½æ•°æ³¨å…¥               | setter æ³¨å…¥                |
| :------------------------- | :------------------------- |
| æ²¡æœ‰éƒ¨åˆ†æ³¨å…¥               | æœ‰éƒ¨åˆ†æ³¨å…¥                 |
| ä¸ä¼šè¦†ç›– setter å±æ€§       | ä¼šè¦†ç›– setter å±æ€§         |
| ä»»æ„ä¿®æ”¹éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°å®ä¾‹ | ä»»æ„ä¿®æ”¹ä¸ä¼šåˆ›å»ºä¸€ä¸ªæ–°å®ä¾‹ |
| é€‚ç”¨äºè®¾ç½®å¾ˆå¤šå±æ€§         | é€‚ç”¨äºè®¾ç½®å°‘é‡å±æ€§         |

- å®é™…åœºæ™¯ä¸‹ï¼Œsetting æ³¨å…¥ä½¿ç”¨çš„æ›´å¤šã€‚

## Spring ä¸­æœ‰å¤šå°‘ç§ IoC å®¹å™¨ï¼Ÿ

Spring æä¾›äº†**ä¸¤ç§( ä¸æ˜¯â€œä¸ªâ€ ) IoC å®¹å™¨**ï¼Œåˆ†åˆ«æ˜¯ `BeanFactory`ã€`ApplicationContext` ã€‚

**BeanFactory**

> BeanFactory åœ¨ `spring-beans` é¡¹ç›®æä¾›ã€‚

BeanFactory ï¼Œå°±åƒä¸€ä¸ªåŒ…å« Bean é›†åˆçš„å·¥å‚ç±»ã€‚å®ƒä¼šåœ¨å®¢æˆ·ç«¯è¦æ±‚æ—¶**å®ä¾‹åŒ– Bean å¯¹è±¡**ã€‚

**ApplicationContextï¼ˆåº”ç”¨ä¸Šä¸‹æ–‡ï¼‰**

> ApplicationContext åœ¨ `spring-context` é¡¹ç›®æä¾›ã€‚

ApplicationContext æ¥å£**æ‰©å±•**äº† BeanFactory æ¥å£ï¼Œå®ƒåœ¨ BeanFactory åŸºç¡€ä¸Šæä¾›äº†ä¸€äº›é¢å¤–çš„åŠŸèƒ½ã€‚å†…ç½®å¦‚ä¸‹åŠŸèƒ½ï¼š

- MessageSource ï¼šç®¡ç† message ï¼Œå®ç°å›½é™…åŒ–ç­‰åŠŸèƒ½ã€‚
- ApplicationEventPublisher ï¼šäº‹ä»¶å‘å¸ƒã€‚
- ResourcePatternResolver ï¼šå¤šèµ„æºåŠ è½½ã€‚
- EnvironmentCapable ï¼šç³»ç»Ÿ Environmentï¼ˆprofile + Propertiesï¼‰ç›¸å…³ã€‚
- Lifecycle ï¼šç®¡ç†ç”Ÿå‘½å‘¨æœŸã€‚
- Closable ï¼šå…³é—­ï¼Œé‡Šæ”¾èµ„æº
- InitializingBeanï¼šè‡ªå®šä¹‰åˆå§‹åŒ–ã€‚
- BeanNameAwareï¼šè®¾ç½® beanName çš„ Aware æ¥å£ã€‚

| BeanFactory                | ApplicationContext       |
| :------------------------- | :----------------------- |
| å®ƒä½¿ç”¨æ‡’åŠ è½½               | å®ƒä½¿ç”¨å³æ—¶åŠ è½½           |
| å®ƒä½¿ç”¨è¯­æ³•æ˜¾å¼æä¾›èµ„æºå¯¹è±¡ | å®ƒè‡ªå·±åˆ›å»ºå’Œç®¡ç†èµ„æºå¯¹è±¡ |
| ä¸æ”¯æŒå›½é™…åŒ–               | æ”¯æŒå›½é™…åŒ–               |
| ä¸æ”¯æŒåŸºäºä¾èµ–çš„æ³¨è§£       | æ”¯æŒåŸºäºä¾èµ–çš„æ³¨è§£       |

å¦å¤–ï¼ŒBeanFactory ä¹Ÿè¢«ç§°ä¸º**ä½çº§**å®¹å™¨ï¼Œè€Œ ApplicationContext è¢«ç§°ä¸º**é«˜çº§**å®¹å™¨ã€‚

1. **ä½çº§å®¹å™¨ åŠ è½½é…ç½®æ–‡ä»¶ï¼ˆä» XMLï¼Œæ•°æ®åº“ï¼ŒAppletï¼‰**ï¼Œå¹¶è§£ææˆ BeanDefinition åˆ°ä½çº§å®¹å™¨ä¸­ã€‚getBean çš„æ“ä½œéƒ½æ˜¯åœ¨ä½çº§å®¹å™¨é‡Œæ“ä½œçš„
   -  åŠ è½½é…ç½®æ–‡ä»¶ï¼Œè§£ææˆ BeanDefinition æ”¾åœ¨ Map é‡Œã€‚
   - è°ƒç”¨ getBean çš„æ—¶å€™ï¼Œä» BeanDefinition æ‰€å±çš„ Map é‡Œï¼Œæ‹¿å‡º Class å¯¹è±¡è¿›è¡Œå®ä¾‹åŒ–ï¼ŒåŒæ—¶ï¼Œå¦‚æœæœ‰ä¾èµ–å…³ç³»ï¼Œå°†é€’å½’è°ƒç”¨ getBean æ–¹æ³• â€”â€” å®Œæˆä¾èµ–æ³¨å…¥ã€‚
2. åŠ è½½æˆåŠŸåï¼Œé«˜çº§å®¹å™¨å¯åŠ¨é«˜çº§åŠŸèƒ½ï¼Œä¾‹å¦‚æ¥å£å›è°ƒï¼Œç›‘å¬å™¨ï¼Œè‡ªåŠ¨å®ä¾‹åŒ–å•ä¾‹ï¼Œå‘å¸ƒäº‹ä»¶ç­‰ç­‰åŠŸèƒ½ã€‚

## è¯·ä»‹ç»ä¸‹å¸¸ç”¨çš„ BeanFactory å®¹å™¨ï¼Ÿ

BeanFactory æœ€å¸¸ç”¨çš„æ˜¯ `XmlBeanFactory` ã€‚å®ƒå¯ä»¥æ ¹æ® XML æ–‡ä»¶ä¸­å®šä¹‰çš„å†…å®¹ï¼Œåˆ›å»ºç›¸åº”çš„ Beanã€‚

## è¯·ä»‹ç»ä¸‹å¸¸ç”¨çš„ ApplicationContext å®¹å™¨ï¼Ÿ

ä»¥ä¸‹æ˜¯ä¸‰ç§è¾ƒå¸¸è§çš„ ApplicationContext å®ç°æ–¹å¼ï¼š

- 1ã€ClassPathXmlApplicationContext ï¼šä» ClassPath çš„ XML é…ç½®æ–‡ä»¶ä¸­è¯»å–ä¸Šä¸‹æ–‡ï¼Œå¹¶ç”Ÿæˆä¸Šä¸‹æ–‡å®šä¹‰ã€‚åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä»ç¨‹åºç¯å¢ƒå˜é‡ä¸­å–å¾—ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

  ```java
  ApplicationContext context = new ClassPathXmlApplicationContext(â€œbean.xmlâ€);
  ```

- 2ã€FileSystemXmlApplicationContext ï¼šç”±æ–‡ä»¶ç³»ç»Ÿä¸­çš„XMLé…ç½®æ–‡ä»¶è¯»å–ä¸Šä¸‹æ–‡ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

  ```java
  ApplicationContext context = new FileSystemXmlApplicationContext(â€œbean.xmlâ€);
  ```

- 3ã€XmlWebApplicationContext ï¼šç”± Web åº”ç”¨çš„XMLæ–‡ä»¶è¯»å–ä¸Šä¸‹æ–‡ã€‚ä¾‹å¦‚æˆ‘ä»¬åœ¨ Spring MVC ä½¿ç”¨çš„æƒ…å†µã€‚

å½“ç„¶ï¼Œç›®å‰æˆ‘ä»¬æ›´å¤šçš„æ˜¯ä½¿ç”¨ Spring Boot ä¸ºä¸»ï¼Œæ‰€ä»¥ä½¿ç”¨çš„æ˜¯ç¬¬å››ç§ ApplicationContext å®¹å™¨ï¼Œ`ConfigServletWebServerApplicationContext` ã€‚

## åˆ—ä¸¾ä¸€äº› IoC çš„ä¸€äº›å¥½å¤„ï¼Ÿ

- å®ƒå°†**æœ€å°åŒ–åº”ç”¨ç¨‹åºä¸­çš„ä»£ç é‡**ã€‚
- å®ƒä»¥æœ€å°çš„å½±å“å’Œæœ€å°‘çš„ä¾µå…¥æœºåˆ¶ä¿ƒè¿›**æ¾è€¦åˆ**ã€‚
- å®ƒ**æ”¯æŒå³æ—¶çš„å®ä¾‹åŒ–å’Œå»¶è¿ŸåŠ è½½ Bean å¯¹è±¡**ã€‚
- å®ƒå°†ä½¿æ‚¨çš„åº”ç”¨ç¨‹åºæ˜“äºæµ‹è¯•ï¼Œå› ä¸ºå®ƒä¸éœ€è¦å•å…ƒæµ‹è¯•ç”¨ä¾‹ä¸­çš„ä»»ä½•å•ä¾‹æˆ– JNDI æŸ¥æ‰¾æœºåˆ¶ã€‚

## ç®€è¿° Spring IoC çš„å®ç°æœºåˆ¶ï¼Ÿ

ç®€å•æ¥è¯´ï¼ŒSpring ä¸­çš„ IoC çš„å®ç°åŸç†ï¼Œå°±æ˜¯**å·¥å‚æ¨¡å¼**ï¼Œé€šè¿‡**åå°„æœºåˆ¶**åˆ›å»ºå¯¹è±¡ã€‚ä»£ç å¦‚ä¸‹ï¼š

åœ¨åŸºå‹ [ã€Šé¢è¯•é—®çƒ‚çš„ Spring IoC è¿‡ç¨‹ã€‹](http://www.iocoder.cn/Fight/Interview-poorly-asked-Spring-IOC-process-1/) çš„æ–‡ç« ä¸­ï¼ŒæŠŠ Spring IoC ç›¸å…³çš„å†…å®¹ï¼Œè®²çš„éå¸¸ä¸é”™ã€‚

## Spring æ¡†æ¶ä¸­æœ‰å“ªäº›ä¸åŒç±»å‹çš„äº‹ä»¶ï¼Ÿ

Spring çš„ ApplicationContext æä¾›äº†**æ”¯æŒäº‹ä»¶å’Œä»£ç ä¸­ç›‘å¬å™¨çš„åŠŸèƒ½**ã€‚

æˆ‘ä»¬å¯ä»¥åˆ›å»º Bean ç”¨æ¥ç›‘å¬åœ¨ ApplicationContext ä¸­å‘å¸ƒçš„äº‹ä»¶ã€‚å¦‚æœä¸€ä¸ª Bean å®ç°äº† ApplicationListener æ¥å£ï¼Œå½“ä¸€ä¸ªApplicationEvent è¢«å‘å¸ƒä»¥åï¼ŒBean ä¼šè‡ªåŠ¨è¢«é€šçŸ¥ã€‚

1. **ä¸Šä¸‹æ–‡æ›´æ–°äº‹ä»¶**ï¼ˆContextRefreshedEventï¼‰ï¼šè¯¥äº‹ä»¶ä¼šåœ¨ApplicationContext è¢«åˆå§‹åŒ–æˆ–è€…æ›´æ–°æ—¶å‘å¸ƒã€‚ä¹Ÿå¯ä»¥åœ¨è°ƒç”¨ConfigurableApplicationContext æ¥å£ä¸­çš„ `#refresh()` æ–¹æ³•æ—¶è¢«è§¦å‘ã€‚
2. **ä¸Šä¸‹æ–‡å¼€å§‹äº‹ä»¶**ï¼ˆContextStartedEventï¼‰ï¼šå½“å®¹å™¨è°ƒç”¨ConfigurableApplicationContext çš„ `#start()` æ–¹æ³•å¼€å§‹/é‡æ–°å¼€å§‹å®¹å™¨æ—¶è§¦å‘è¯¥äº‹ä»¶ã€‚
3. **ä¸Šä¸‹æ–‡åœæ­¢äº‹ä»¶**ï¼ˆContextStoppedEventï¼‰ï¼šå½“å®¹å™¨è°ƒç”¨ ConfigurableApplicationContext çš„ `#stop()` æ–¹æ³•åœæ­¢å®¹å™¨æ—¶è§¦å‘è¯¥äº‹ä»¶ã€‚
4. **ä¸Šä¸‹æ–‡å…³é—­äº‹ä»¶**ï¼ˆContextClosedEventï¼‰ï¼šå½“ApplicationContext è¢«å…³é—­æ—¶è§¦å‘è¯¥äº‹ä»¶ã€‚å®¹å™¨è¢«å…³é—­æ—¶ï¼Œå…¶ç®¡ç†çš„æ‰€æœ‰å•ä¾‹ Bean éƒ½è¢«é”€æ¯ã€‚
5. **è¯·æ±‚å¤„ç†äº‹ä»¶**ï¼ˆRequestHandledEventï¼‰ï¼šåœ¨ We båº”ç”¨ä¸­ï¼Œå½“ä¸€ä¸ªHTTP **è¯·æ±‚ï¼ˆrequestï¼‰ç»“æŸè§¦å‘**è¯¥äº‹ä»¶ã€‚
6. é€šè¿‡æ‰©å±• ApplicationEvent ç±»æ¥å¼€å‘**è‡ªå®šä¹‰**çš„äº‹ä»¶ã€‚

# Spring Bean

## ä»€ä¹ˆæ˜¯ Spring Bean ï¼Ÿ

- Bean ç”± Spring IoC å®¹å™¨å®ä¾‹åŒ–ï¼Œé…ç½®ï¼Œè£…é…å’Œç®¡ç†ã€‚
- Bean æ˜¯åŸºäºç”¨æˆ·æä¾›ç»™ IoC å®¹å™¨çš„é…ç½®å…ƒæ•°æ® Bean Definition åˆ›å»ºã€‚

## Spring æœ‰å“ªäº›é…ç½®æ–¹å¼

å•çº¯ä» Spring Framework æä¾›çš„æ–¹å¼ï¼Œä¸€å…±æœ‰ä¸‰ç§ï¼š

- 1ã€XML é…ç½®æ–‡ä»¶ã€‚

- 2ã€æ³¨è§£é…ç½®ã€‚

- 3ã€Java Config é…ç½®ã€‚

  Spring çš„ Java é…ç½®æ˜¯é€šè¿‡ä½¿ç”¨ @Bean å’Œ @Configuration æ¥å®ç°ã€‚

  - Spring Boot ä½¿ç”¨çš„å°±æ˜¯

## Spring æ”¯æŒå‡ ç§ Bean Scopeï¼ˆä½œç”¨åŸŸï¼‰ ï¼Ÿ

> è‰¿è‰¿ï¼Œè¿™ä¸ªæ˜¯ä¸€ä¸ªæ¯”è¾ƒå°ä¼—çš„é¢˜ç›®ï¼Œç®€å•äº†è§£å³å¯ã€‚

Spring Bean æ”¯æŒ 5 ç§ Scope ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š

- `Singleton` - æ¯ä¸ª Spring IoC å®¹å™¨ä»…æœ‰ä¸€ä¸ªå• Bean å®ä¾‹ã€‚**é»˜è®¤**
- `Prototype` - çº¿ç¨‹æ¯æ¬¡è¯·æ±‚éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚
- `Request` - æ¯ä¸€æ¬¡ HTTP è¯·æ±‚éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ Bean å®ä¾‹ï¼Œå¹¶ä¸”è¯¥ Bean ä»…åœ¨å½“å‰ HTTP è¯·æ±‚å†…æœ‰æ•ˆã€‚
- `Session` - æ¯ä¸€ä¸ªçš„ Session éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ Bean å®ä¾‹ï¼ŒåŒæ—¶è¯¥ Bean ä»…åœ¨å½“å‰ HTTP Session å†…æœ‰æ•ˆã€‚
- `Application` - æ¯ä¸€ä¸ª Web Application éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ Bean ï¼ŒåŒæ—¶è¯¥ Bean ä»…åœ¨å½“å‰ Web Application å†…æœ‰æ•ˆã€‚
- è‡ªå®šä¹‰ Bean Scope

## ï¼ˆé‡ç‚¹ï¼‰Spring Bean åœ¨å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ

> è‰¿è‰¿è¯´ï¼šè¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒé«˜çº§çš„ Spring çš„é¢è¯•é¢˜ï¼Œéå¸¸å¸¸è§ï¼Œå¹¶ä¸”ç­”å¯¹æ¯”è¾ƒåŠ åˆ†ã€‚å½“ç„¶ï¼Œå¦‚æœå®é™…çœŸæ­£å¼„æ‡‚ï¼Œéœ€è¦å¯¹ Spring Bean çš„æºç ï¼Œæœ‰æ¯”è¾ƒå¥½çš„ç†è§£ï¼Œæ‰€ä»¥ [ã€Šç²¾å°½ Spring æºç ã€‹](http://svip.iocoder.cn/categories/Spring/) ç³»åˆ—ï¼Œè¯¥è¯»è¿˜æ˜¯è¯»å§ã€‚

> è‰¿è‰¿ï¼šè¦æ³¨æ„ä¸‹é¢æ¯æ®µè¯ï¼Œè‰¿è‰¿è¿›è¡ŒåŠ ç²—çš„åœ°æ–¹ã€‚

Spring Bean çš„**åˆå§‹åŒ–**æµç¨‹å¦‚ä¸‹ï¼š

- å®ä¾‹åŒ– Bean å¯¹è±¡

  - Spring å®¹å™¨æ ¹æ®é…ç½®ä¸­çš„ Bean Definition(å®šä¹‰)ä¸­**å®ä¾‹åŒ–** Bean å¯¹è±¡ã€‚

    > Bean Definition å¯ä»¥é€šè¿‡ XMLï¼ŒJava æ³¨è§£æˆ– Java Config ä»£ç æä¾›ã€‚

  - Spring ä½¿ç”¨ä¾èµ–æ³¨å…¥**å¡«å……**æ‰€æœ‰å±æ€§ï¼Œå¦‚ Bean ä¸­æ‰€å®šä¹‰çš„é…ç½®ã€‚

- Aware ç›¸å…³çš„å±æ€§ï¼Œæ³¨å…¥åˆ° Bean å¯¹è±¡

  - å¦‚æœ Bean å®ç° **BeanNameAware** æ¥å£ï¼Œåˆ™å·¥å‚é€šè¿‡ä¼ é€’ Bean çš„ beanName æ¥è°ƒç”¨ `#setBeanName(String name)` æ–¹æ³•ã€‚
  - å¦‚æœ Bean å®ç° **BeanFactoryAware** æ¥å£ï¼Œå·¥å‚é€šè¿‡ä¼ é€’è‡ªèº«çš„å®ä¾‹æ¥è°ƒç”¨ `#setBeanFactory(BeanFactory beanFactory)` æ–¹æ³•ã€‚

- è°ƒç”¨ç›¸åº”çš„æ–¹æ³•ï¼Œè¿›ä¸€æ­¥åˆå§‹åŒ– Bean å¯¹è±¡

  - å¦‚æœå­˜åœ¨ä¸ Bean å…³è”çš„ä»»ä½• **BeanPostProcessor** ä»¬ï¼Œåˆ™è°ƒç”¨ `#preProcessBeforeInitialization(Object bean, String beanName)` æ–¹æ³•ã€‚
  - å¦‚æœ Bean å®ç° **InitializingBean** æ¥å£ï¼Œåˆ™ä¼šè°ƒç”¨ `#afterPropertiesSet()` æ–¹æ³•ã€‚
  - å¦‚æœä¸º Bean æŒ‡å®šäº† **init** æ–¹æ³•ï¼ˆä¾‹å¦‚ `` çš„ `init-method` å±æ€§ï¼‰ï¼Œé‚£ä¹ˆå°†è°ƒç”¨è¯¥æ–¹æ³•ã€‚
  - å¦‚æœå­˜åœ¨ä¸ Bean å…³è”çš„ä»»ä½• **BeanPostProcessor** ä»¬ï¼Œåˆ™å°†è°ƒç”¨ `#postProcessAfterInitialization(Object bean, String beanName)` æ–¹æ³•ã€‚

Spring Bean çš„**é”€æ¯**æµç¨‹å¦‚ä¸‹ï¼š

- å¦‚æœ Bean å®ç° **DisposableBean** æ¥å£ï¼Œå½“ spring å®¹å™¨å…³é—­æ—¶ï¼Œä¼šè°ƒç”¨ `#destroy()` æ–¹æ³•ã€‚
- å¦‚æœä¸º bean æŒ‡å®šäº† **destroy** æ–¹æ³•ï¼ˆä¾‹å¦‚ `` çš„ `destroy-method` å±æ€§ï¼‰ï¼Œé‚£ä¹ˆå°†è°ƒç”¨è¯¥æ–¹æ³•ã€‚

æ•´ä½“å¦‚ä¸‹å›¾ï¼š[![æµç¨‹å›¾](http://static2.iocoder.cn/images/Spring/2018-12-24/03.jpg)](http://static2.iocoder.cn/images/Spring/2018-12-24/03.jpg)æµç¨‹å›¾

æ— æ„ä¸­ï¼Œè‰¿è‰¿åˆç¿»åˆ°ä¸€å¼ æœ‰è¶£çš„æ•´ä½“å›¾ï¼Œå¦‚ä¸‹å›¾ï¼š

[![æµç¨‹å›¾](http://static2.iocoder.cn/images/Spring/2018-12-24/08.png)](http://static2.iocoder.cn/images/Spring/2018-12-24/08.png)æµç¨‹å›¾

## ä»€ä¹ˆæ˜¯ Spring çš„å†…éƒ¨ beanï¼Ÿ

åªæœ‰å°† Bean **ä»…**ç”¨ä½œå¦ä¸€ä¸ª Bean çš„å±æ€§æ—¶ï¼Œæ‰èƒ½å°† Bean å£°æ˜ä¸ºå†…éƒ¨ Beanã€‚

- ä¸ºäº†å®šä¹‰ Beanï¼ŒSpring æä¾›åŸºäº XML çš„é…ç½®å…ƒæ•°æ®åœ¨ ``æˆ– `` ä¸­æä¾›äº† ``å…ƒç´ çš„ä½¿ç”¨ã€‚
- å†…éƒ¨ Bean æ€»æ˜¯**åŒ¿å**çš„ï¼Œå¹¶ä¸”å®ƒä»¬æ€»æ˜¯ä½œä¸º**åŸå‹ Prototype** ã€‚

## ä»€ä¹ˆæ˜¯ Spring è£…é…ï¼Ÿ

å½“ Bean åœ¨ Spring å®¹å™¨ä¸­ç»„åˆåœ¨ä¸€èµ·æ—¶ï¼Œå®ƒè¢«ç§°ä¸º**è£…é…**æˆ– **Bean è£…é…**ã€‚

> è£…é…ï¼Œå’Œä¸Šæ–‡æåˆ°çš„ DI ä¾èµ–æ³¨å…¥ï¼Œå®é™…æ˜¯ä¸€ä¸ªä¸œè¥¿ã€‚

**è‡ªåŠ¨è£…é…æœ‰å“ªäº›æ–¹å¼ï¼Ÿ**

Spring å®¹å™¨èƒ½å¤Ÿè‡ªåŠ¨è£…é… Bean ã€‚

è‡ªåŠ¨è£…é…çš„ä¸åŒæ¨¡å¼ï¼š

- **no** - è¿™æ˜¯é»˜è®¤è®¾ç½®ï¼Œè¡¨ç¤ºæ²¡æœ‰è‡ªåŠ¨è£…é…ã€‚åº”ä½¿ç”¨æ˜¾å¼ Bean å¼•ç”¨è¿›è¡Œè£…é…ã€‚
- **byName** - å®ƒæ ¹æ® Bean çš„åç§°æ³¨å…¥å¯¹è±¡ä¾èµ–é¡¹ã€‚å®ƒåŒ¹é…å¹¶è£…é…å…¶å±æ€§ä¸ XML æ–‡ä»¶ä¸­ç”±ç›¸åŒåç§°å®šä¹‰çš„ Bean ã€‚
- ã€æœ€å¸¸ç”¨ã€‘**byType** - å®ƒæ ¹æ®ç±»å‹æ³¨å…¥å¯¹è±¡ä¾èµ–é¡¹ã€‚å¦‚æœå±æ€§çš„ç±»å‹ä¸ XML æ–‡ä»¶ä¸­çš„ä¸€ä¸ª Bean ç±»å‹åŒ¹é…ï¼Œåˆ™åŒ¹é…å¹¶è£…é…å±æ€§ã€‚
- æ„é€ å‡½æ•°
- autodetect - é¦–å…ˆå®¹å™¨å°è¯•é€šè¿‡æ„é€ å‡½æ•°ä½¿ç”¨ autowire è£…é…ï¼Œå¦‚æœä¸èƒ½ï¼Œåˆ™å°è¯•é€šè¿‡ byType è‡ªåŠ¨è£…é…ã€‚

## è§£é‡Šä»€ä¹ˆå«å»¶è¿ŸåŠ è½½ï¼Ÿ

é»˜è®¤æƒ…å†µä¸‹ï¼Œå®¹å™¨å¯åŠ¨ä¹‹åä¼šå°†æ‰€æœ‰ä½œç”¨åŸŸä¸º**å•ä¾‹**çš„ Bean éƒ½åˆ›å»ºå¥½ï¼Œä½†æ˜¯æœ‰çš„ä¸šåŠ¡åœºæ™¯æˆ‘ä»¬å¹¶ä¸éœ€è¦å®ƒæå‰éƒ½åˆ›å»ºå¥½ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Bean ä¸­è®¾ç½® `lzay-init = "true"` ã€‚

## Spring æ¡†æ¶ä¸­çš„å•ä¾‹ Bean æ˜¯çº¿ç¨‹å®‰å…¨çš„ä¹ˆï¼Ÿ

ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ŒSpring æ¡†æ¶å¹¶æ²¡æœ‰å¯¹[å•ä¾‹](http://howtodoinjava.com/2012/10/22/singleton-design-pattern-in-java/) Bean è¿›è¡Œä»»ä½•å¤šçº¿ç¨‹çš„å°è£…å¤„ç†ã€‚ä»…æä¾›æ ¹æ®é…ç½®ï¼Œåˆ›å»ºå•ä¾‹ Bean æˆ–å¤šä¾‹ Bean çš„åŠŸèƒ½ã€‚ä½†å®é™…ä¸Šï¼Œå¤§éƒ¨åˆ†çš„ Spring Bean å¹¶æ²¡æœ‰å¯å˜çš„çŠ¶æ€(æ¯”å¦‚Serview ç±»å’Œ DAO ç±»)ï¼Œæ‰€ä»¥åœ¨æŸç§ç¨‹åº¦ä¸Šè¯´ Spring çš„å•ä¾‹ Bean æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚

å¦‚æœä½ çš„ Bean æœ‰å¤šç§çŠ¶æ€çš„è¯ï¼Œå°±éœ€è¦è‡ªè¡Œä¿è¯çº¿ç¨‹å®‰å…¨ã€‚æœ€æµ…æ˜¾çš„è§£å†³åŠæ³•ï¼Œå°±æ˜¯å°†å¤šæ€ Bean çš„ä½œç”¨åŸŸ( Scope )ç”± Singleton å˜æ›´ä¸º Prototype ã€‚

## ï¼ˆé‡ç‚¹ï¼‰Spring Bean æ€ä¹ˆè§£å†³å¾ªç¯ä¾èµ–çš„é—®é¢˜ï¼Ÿ

https://blog.csdn.net/u010853261/article/details/77940767

# Spring æ³¨è§£

## ä»€ä¹ˆæ˜¯åŸºäºæ³¨è§£çš„å®¹å™¨é…ç½®ï¼Ÿ

ä¸ä½¿ç”¨ XML æ¥æè¿° Bean è£…é…ï¼Œå¼€å‘äººå‘˜é€šè¿‡åœ¨ç›¸å…³çš„ç±»ï¼Œæ–¹æ³•æˆ–å­—æ®µå£°æ˜ä¸Šä½¿ç”¨**æ³¨è§£**å°†é…ç½®ç§»åŠ¨åˆ°ç»„ä»¶ç±»æœ¬èº«ã€‚å®ƒå¯ä»¥ä½œä¸º XML è®¾ç½®çš„æ›¿ä»£æ–¹æ¡ˆã€‚ä¾‹å¦‚ï¼š

Spring çš„ Java é…ç½®æ˜¯é€šè¿‡ä½¿ç”¨ `@Bean` å’Œ `@Configuration` æ¥å®ç°ã€‚

## [@Configurationå’Œ@ComponentåŒºåˆ«](https://blog.csdn.net/ctwy291314/article/details/104428533)

`@Configuration`æ³¨è§£ä¸­æ˜¯åŒ…å«`@Component`æ³¨è§£çš„

`@Configuration`å°±ç›¸å½“äºSpringé…ç½®æ–‡ä»¶ä¸­çš„``æ ‡ç­¾ï¼Œé‡Œé¢å¯ä»¥é…ç½®bean

æ¦‚æ‹¬å°±æ˜¯ @Configuration ä¸­æ‰€æœ‰å¸¦ @Bean æ³¨è§£çš„æ–¹æ³•éƒ½ä¼šè¢«åŠ¨æ€ä»£ç†ï¼Œå› æ­¤è°ƒç”¨è¯¥æ–¹æ³•è¿”å›çš„éƒ½æ˜¯**åŒä¸€ä¸ªå®ä¾‹**ã€‚

å…¶å·¥ä½œåŸç†æ˜¯ï¼šå¦‚æœæ–¹å¼æ˜¯é¦–æ¬¡è¢«è°ƒç”¨é‚£ä¹ˆåŸå§‹çš„æ–¹æ³•ä½“ä¼šè¢«æ‰§è¡Œå¹¶ä¸”ç»“æœå¯¹è±¡ä¼šè¢«æ³¨å†Œåˆ°Springä¸Šä¸‹æ–‡ä¸­ï¼Œä¹‹åæ‰€æœ‰çš„å¯¹è¯¥æ–¹æ³•çš„è°ƒç”¨ä»…ä»…åªæ˜¯ä»Springä¸Šä¸‹æ–‡ä¸­å–å›è¯¥å¯¹è±¡è¿”å›ç»™è°ƒç”¨è€…ã€‚

@Componentï¼Œåªæ˜¯çº¯JAVAæ–¹å¼çš„è°ƒç”¨ï¼Œå¤šæ¬¡è°ƒç”¨è¯¥æ–¹æ³•è¿”å›çš„æ˜¯ä¸åŒçš„å¯¹è±¡å®ä¾‹ã€‚

## å¦‚ä½•åœ¨ Spring ä¸­å¯åŠ¨æ³¨è§£è£…é…ï¼Ÿ

é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring å®¹å™¨ä¸­æœªæ‰“å¼€æ³¨è§£è£…é…ã€‚ä½¿ç”¨ Spring Boot ï¼Œé»˜è®¤æƒ…å†µä¸‹å·²ç»å¼€å¯ã€‚

## @Component, @Controller, @Repository, @Service æœ‰ä½•åŒºåˆ«ï¼Ÿ

- `@Component` ï¼šå®ƒå°† Java ç±»æ ‡è®°ä¸º Bean ã€‚å®ƒæ˜¯ä»»ä½• Spring ç®¡ç†ç»„ä»¶çš„**é€šç”¨**æ„é€ å‹ã€‚
- `@Controller` ï¼šå®ƒå°†ä¸€ä¸ªç±»æ ‡è®°ä¸º Spring Web MVC **æ§åˆ¶å™¨**ã€‚
- `@Service` ï¼šæ­¤æ³¨è§£æ˜¯ç»„ä»¶æ³¨è§£çš„ç‰¹åŒ–ã€‚å®ƒä¸ä¼šå¯¹ `@Component` æ³¨è§£æä¾›ä»»ä½•å…¶ä»–è¡Œä¸ºã€‚æ‚¨å¯ä»¥åœ¨**æœåŠ¡å±‚**ç±»ä¸­ä½¿ç”¨ @Service è€Œä¸æ˜¯ `@Component` ï¼Œå› ä¸ºå®ƒä»¥æ›´å¥½çš„æ–¹å¼æŒ‡å®šäº†æ„å›¾ã€‚
- `@Repository` ï¼šè¿™ä¸ªæ³¨è§£æ˜¯å…·æœ‰ç±»ä¼¼ç”¨é€”å’ŒåŠŸèƒ½çš„ `@Component` æ³¨è§£çš„ç‰¹åŒ–ã€‚å®ƒä¸º **DAO** æä¾›äº†é¢å¤–çš„å¥½å¤„ã€‚å®ƒå°† DAO å¯¼å…¥ IoC å®¹å™¨ï¼Œå¹¶ä½¿æœªç»æ£€æŸ¥çš„å¼‚å¸¸æœ‰èµ„æ ¼è½¬æ¢ä¸º Spring DataAccessException ã€‚

## @Required æ³¨è§£æœ‰ä»€ä¹ˆç”¨ï¼Ÿ

`@Required` æ³¨è§£ï¼Œåº”ç”¨äº Bean å±æ€§ setter æ–¹æ³•ã€‚

- æ­¤æ³¨è§£ä»…æŒ‡ç¤ºå¿…é¡»åœ¨é…ç½®æ—¶ä½¿ç”¨ Bean å®šä¹‰ä¸­çš„æ˜¾å¼å±æ€§å€¼æˆ–ä½¿ç”¨è‡ªåŠ¨è£…é…å¡«å……å—å½±å“çš„ Bean å±æ€§ã€‚
- å¦‚æœå°šæœªå¡«å……å—å½±å“çš„ Bean å±æ€§ï¼Œåˆ™å®¹å™¨å°†æŠ›å‡º BeanInitializationException å¼‚å¸¸ã€‚

ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```
public class Employee {

    private String name;
    
    @Required
    public void setName(String name){
        this.name=name;
    }
    
    public string getName(){
        return name;
    }
    
}
```

- T T è²Œä¼¼å¹³æ—¶å¾ˆå°‘ç”¨è¿™ä¸ªæ³¨è§£å™¢ã€‚

## @Autowired æ³¨è§£æœ‰ä»€ä¹ˆç”¨ï¼Ÿ

`@Autowired` æ³¨è§£ï¼Œå¯ä»¥æ›´å‡†ç¡®åœ°æ§åˆ¶åº”è¯¥åœ¨ä½•å¤„ä»¥åŠ**å¦‚ä½•è¿›è¡Œè‡ªåŠ¨è£…é…bean**ã€‚

- æ­¤æ³¨è§£ç”¨äºåœ¨ setter æ–¹æ³•ï¼Œæ„é€ å‡½æ•°ï¼Œå…·æœ‰ä»»æ„åç§°æˆ–å¤šä¸ªå‚æ•°çš„å±æ€§æˆ–æ–¹æ³•ä¸Šè‡ªåŠ¨è£…é… Beanã€‚
- é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒæ˜¯ç±»å‹é©±åŠ¨çš„æ³¨å…¥ã€‚

## @Autowired ä¸@Resourceçš„åŒºåˆ«

@Autowiredé»˜è®¤æŒ‰ç±»å‹è£…é…ï¼ˆè¿™ä¸ªæ³¨è§£æ˜¯å±ä¸šspringçš„ï¼‰

@Resourceï¼ˆè¿™ä¸ªæ³¨è§£å±äºJ2EEçš„ï¼‰ï¼Œé»˜è®¤æŒ‰ç…§åç§°è¿›è¡Œè£…é…ï¼Œåç§°å¯ä»¥é€šè¿‡nameå±æ€§è¿›è¡ŒæŒ‡å®šã€‚å½“æ‰¾ä¸åˆ°ä¸åç§°åŒ¹é…çš„beanæ—¶æ‰æŒ‰ç…§ç±»å‹è¿›è¡Œè£…é…ã€‚

## @Qualifier æ³¨è§£æœ‰ä»€ä¹ˆç”¨ï¼Ÿ

å½“ä½ åˆ›å»ºå¤šä¸ª**ç›¸åŒç±»å‹**çš„ Bean ï¼Œå¹¶å¸Œæœ›ä»…ä½¿ç”¨å±æ€§è£…é…**å…¶ä¸­ä¸€ä¸ª** Bean æ—¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ `@Qualifier` æ³¨è§£å’Œ `@Autowired` é€šè¿‡æŒ‡å®š ID åº”è¯¥è£…é…å“ªä¸ª**ç¡®åˆ‡çš„** Bean æ¥æ¶ˆé™¤æ­§ä¹‰ã€‚

# Spring AOP

> Spring AOP çš„é¢è¯•é¢˜ä¸­ï¼Œå¤§å¤šæ•°éƒ½æ˜¯æ¦‚å¿µé¢˜ï¼Œä¸»è¦æ˜¯å¯¹åˆ‡é¢çš„ç†è§£ã€‚æ¦‚å¿µç‚¹ä¸»è¦æœ‰ï¼š
>
> - AOPï¼šåˆ‡é¢ã€åŠ¨æ€ä»£ç†
> - Aspect
> - JoinPoint
> - PointCut
> - Advice
> - Target
> - AOP Proxy
> - Weaving

- åœ¨é˜…è¯»å®Œ [ã€ŒSpring AOPã€](http://svip.iocoder.cn/Spring/Interview/#) çš„é¢è¯•é¢˜åï¼Œåœ¨å›è¿‡å¤´æ€è€ƒä¸‹è¿™äº›æ¦‚å¿µç‚¹ï¼Œåˆ°åº•ç†è§£äº†å¤šå°‘ã€‚æ³¨æ„ï¼Œä¸æ˜¯èƒŒï¼Œç†è§£ï¼

éå¸¸æ¨èé˜…è¯»å¦‚ä¸‹ä¸¤ç¯‡æ–‡ç« ï¼š

- [ã€Šå½»åº•å¾æœ Spring AOP ä¹‹ç†è®ºç¯‡ã€‹](https://segmentfault.com/a/1190000007469968)
- [ã€Šå½»åº•å¾æœ Spring AOP ä¹‹å®æˆ˜ç¯‡ã€‹](https://segmentfault.com/a/1190000007469982)

## ä»€ä¹ˆæ˜¯ AOP ï¼Ÿ

AOP(Aspect-Oriented Programming)ï¼Œå³**é¢å‘åˆ‡é¢ç¼–ç¨‹**, å®ƒä¸ OOP( Object-Oriented Programming, é¢å‘å¯¹è±¡ç¼–ç¨‹) ç›¸è¾…ç›¸æˆï¼Œ æä¾›äº†ä¸ OOP ä¸åŒçš„æŠ½è±¡è½¯ä»¶ç»“æ„çš„è§†è§’ã€‚

- åœ¨ OOP ä¸­ï¼Œä»¥ç±»( Class )ä½œä¸ºåŸºæœ¬å•å…ƒ
- åœ¨ AOP ä¸­ï¼Œä»¥**åˆ‡é¢( Aspect )**ä½œä¸ºåŸºæœ¬å•å…ƒã€‚

AOPçš„å®ç°åŸç†ä¸ºåŠ¨æ€ä»£ç†æŠ€æœ¯ï¼Œä¸€å…±æœ‰ä¸¤ç§ä»£ç†æ¨¡å¼ï¼š

ï¼ˆ1ï¼‰`ProxyFactoryBean`ä»£ç†å·¥å‚å¯¹è±¡

Springå†…ç½®ä»£ç†ç±»ï¼Œå¼•å…¥ä¸€ä¸ªä¸­é—´å±‚ï¼Œèƒ½å¤Ÿåˆ›å»ºä¸åŒç±»å‹çš„å¯¹è±¡ï¼Œåˆ©ç”¨å®ƒå¯ä»¥å®ç°ä»»ä½•å½¢å¼çš„AOPã€‚

ï¼ˆ2ï¼‰`TransactionProxyFactoryBean`äº‹åŠ¡ä»£ç†å·¥å‚å¯¹è±¡

å¸¸ç”¨åœ¨æ•°æ®åº“ç¼–ç¨‹ä¸Šï¼ŒSpringåˆ©ç”¨TransactionProxyFactoryBeanå¯¹äº‹åŠ¡è¿›è¡Œç®¡ç†ï¼Œåœ¨**æŒ‡å®šæ–¹æ³•å‰åˆ©ç”¨AOPè¿æ¥æ•°æ®åº“å¹¶å¼€å¯äº‹åŠ¡ï¼Œç„¶ååœ¨æŒ‡å®šæ–¹æ³•è¿”å›ååˆ©ç”¨AOPæäº¤äº‹åŠ¡å¹¶æ–­å¼€æ•°æ®åº“**ã€‚

## ä»€ä¹ˆæ˜¯ Aspect ï¼Ÿ

Aspect ç”± **PointCut** å’Œ **Advice** ç»„æˆã€‚

- å®ƒæ—¢åŒ…å«äº†æ¨ªåˆ‡é€»è¾‘çš„å®šä¹‰ï¼Œä¹ŸåŒ…æ‹¬äº†è¿æ¥ç‚¹çš„å®šä¹‰ã€‚
- Spring AOP å°±æ˜¯è´Ÿè´£å®æ–½åˆ‡é¢çš„æ¡†æ¶ï¼Œå®ƒå°†åˆ‡é¢æ‰€å®šä¹‰çš„æ¨ªåˆ‡é€»è¾‘ç¼–ç»‡åˆ°åˆ‡é¢æ‰€æŒ‡å®šçš„è¿æ¥ç‚¹ä¸­ã€‚

AOP çš„å·¥ä½œé‡å¿ƒåœ¨äº**å¦‚ä½•å°†å¢å¼ºç¼–ç»‡ç›®æ ‡å¯¹è±¡çš„è¿æ¥ç‚¹ä¸Š**, è¿™é‡ŒåŒ…å«ä¸¤ä¸ªå·¥ä½œ:

1. å¦‚ä½•é€šè¿‡ PointCut å’Œ Advice å®šä½åˆ°ç‰¹å®šçš„ **JoinPoint** ä¸Šã€‚
2. å¦‚ä½•åœ¨ Advice ä¸­ç¼–å†™åˆ‡é¢ä»£ç ã€‚

**å¯ä»¥ç®€å•åœ°è®¤ä¸º, ä½¿ç”¨ @Aspect æ³¨è§£çš„ç±»å°±æ˜¯åˆ‡é¢**

[![æµç¨‹å›¾](http://static2.iocoder.cn/images/Spring/2018-12-24/04.jpg)](http://static2.iocoder.cn/images/Spring/2018-12-24/04.jpg)æµç¨‹å›¾

## ä»€ä¹ˆæ˜¯ JoinPoint ?

JoinPoint ï¼Œ**åˆ‡ç‚¹**ï¼Œç¨‹åºè¿è¡Œä¸­çš„ä¸€äº›æ—¶é—´ç‚¹, ä¾‹å¦‚ï¼š

- ä¸€ä¸ªæ–¹æ³•çš„æ‰§è¡Œã€‚
- æˆ–è€…æ˜¯ä¸€ä¸ªå¼‚å¸¸çš„å¤„ç†ã€‚

åœ¨ Spring AOP ä¸­ï¼ŒJoinPoint æ€»æ˜¯æ–¹æ³•çš„æ‰§è¡Œç‚¹ã€‚

## ä»€ä¹ˆæ˜¯ PointCut ï¼Ÿ

PointCut ï¼Œ**PointCut æ˜¯åŒ¹é… JoinPoint çš„æ¡ä»¶**ã€‚

- Advice æ˜¯å’Œç‰¹å®šçš„ PointCut å…³è”çš„ï¼Œå¹¶ä¸”åœ¨ PointCut ç›¸åŒ¹é…çš„ JoinPoint ä¸­æ‰§è¡Œã€‚å³ `Advice => PointCut => JoinPoint` ã€‚
- åœ¨ Spring ä¸­, æ‰€æœ‰çš„æ–¹æ³•éƒ½å¯ä»¥è®¤ä¸ºæ˜¯ JoinPoint ï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶ä¸å¸Œæœ›åœ¨æ‰€æœ‰çš„æ–¹æ³•ä¸Šéƒ½æ·»åŠ  Advice ã€‚**è€Œ PointCut çš„ä½œç”¨**ï¼Œå°±æ˜¯æä¾›ä¸€ç»„è§„åˆ™(ä½¿ç”¨ AspectJ PointCut expression language æ¥æè¿°) æ¥åŒ¹é… JoinPoint ï¼Œç»™æ»¡è¶³è§„åˆ™çš„ JoinPoint æ·»åŠ  Advice ã€‚

## å…³äº JoinPoint å’Œ PointCut çš„åŒºåˆ«

1. é¦–å…ˆï¼ŒAdvice é€šè¿‡ PointCut æŸ¥è¯¢éœ€è¦è¢«ç»‡å…¥çš„ JoinPoint ã€‚
2. ç„¶åï¼ŒAdvice åœ¨æŸ¥è¯¢åˆ° JoinPoint **ä¸Š**æ‰§è¡Œé€»è¾‘ã€‚

## ä»€ä¹ˆæ˜¯ Advice ï¼Ÿ

Advice ï¼Œ**é€šçŸ¥**ã€‚

- ç‰¹å®š JoinPoint å¤„çš„ Aspect æ‰€**é‡‡å–çš„åŠ¨ä½œç§°ä¸º Advice** ã€‚

**æœ‰å“ªäº›ç±»å‹çš„ Adviceï¼Ÿ**

- Before - è¿™äº›ç±»å‹çš„ Advice åœ¨ JoinPoint æ–¹æ³•ä¹‹å‰æ‰§è¡Œï¼Œå¹¶ä½¿ç”¨ `@Before` æ³¨è§£æ ‡è®°è¿›è¡Œé…ç½®ã€‚
- After Returning - è¿™äº›ç±»å‹çš„ Advice åœ¨è¿æ¥ç‚¹æ–¹æ³•æ­£å¸¸æ‰§è¡Œåæ‰§è¡Œï¼Œå¹¶ä½¿ç”¨ `@AfterReturning` æ³¨è§£æ ‡è®°è¿›è¡Œé…ç½®ã€‚
- After Throwing - è¿™äº›ç±»å‹çš„ Advice ä»…åœ¨ JoinPoint æ–¹æ³•é€šè¿‡æŠ›å‡ºå¼‚å¸¸é€€å‡ºå¹¶ä½¿ç”¨ `@AfterThrowing` æ³¨è§£æ ‡è®°é…ç½®æ—¶æ‰§è¡Œã€‚
- After Finally - è¿™äº›ç±»å‹çš„ Advice åœ¨è¿æ¥ç‚¹æ–¹æ³•ä¹‹åæ‰§è¡Œï¼Œæ— è®ºæ–¹æ³•é€€å‡ºæ˜¯æ­£å¸¸è¿˜æ˜¯å¼‚å¸¸è¿”å›ï¼Œå¹¶ä½¿ç”¨ `@After` æ³¨è§£æ ‡è®°è¿›è¡Œé…ç½®ã€‚
- Around - è¿™äº›ç±»å‹çš„ Advice åœ¨è¿æ¥ç‚¹ä¹‹å‰å’Œä¹‹åæ‰§è¡Œï¼Œå¹¶ä½¿ç”¨ `@Around` æ³¨è§£æ ‡è®°è¿›è¡Œé…ç½®ã€‚

## ä»€ä¹ˆæ˜¯ Target ï¼Ÿ

Target ï¼Œç»‡å…¥ Advice çš„**ç›®æ ‡å¯¹è±¡**ã€‚ç›®æ ‡å¯¹è±¡ä¹Ÿè¢«ç§°ä¸º **Advised Object** ã€‚

- å› ä¸º Spring AOP ä½¿ç”¨è¿è¡Œæ—¶ä»£ç†çš„æ–¹å¼æ¥å®ç° Aspect ï¼Œå› æ­¤ Advised Object æ€»æ˜¯ä¸€ä¸ªä»£ç†å¯¹è±¡(Proxied Object) ã€‚
- **æ³¨æ„, Advised Object æŒ‡çš„ä¸æ˜¯åŸæ¥çš„å¯¹è±¡ï¼Œè€Œæ˜¯ç»‡å…¥ Advice åæ‰€äº§ç”Ÿçš„ä»£ç†å¯¹è±¡**ã€‚
- Advice + Target Object = Advised Object = Proxy ã€‚

## AOP æœ‰å“ªäº›å®ç°æ–¹å¼ï¼Ÿ

å®ç° AOP çš„æŠ€æœ¯ï¼Œä¸»è¦åˆ†ä¸ºä¸¤å¤§ç±»ï¼š

- â‘  **é™æ€ä»£ç†** - æŒ‡ä½¿ç”¨ AOP æ¡†æ¶æä¾›çš„å‘½ä»¤è¿›è¡Œç¼–è¯‘ï¼Œä»è€Œ**åœ¨ç¼–è¯‘é˜¶æ®µ**å°±å¯ç”Ÿæˆ AOP ä»£ç†ç±»ï¼Œå› æ­¤ä¹Ÿç§°ä¸ºç¼–è¯‘æ—¶å¢å¼ºã€‚

  - ç¼–è¯‘æ—¶ç¼–ç»‡ï¼ˆç‰¹æ®Šç¼–è¯‘å™¨å®ç°ï¼‰

  - ç±»åŠ è½½æ—¶ç¼–ç»‡ï¼ˆç‰¹æ®Šçš„ç±»åŠ è½½å™¨å®ç°ï¼‰ã€‚

- â‘¡ **åŠ¨æ€ä»£ç†** - åœ¨**è¿è¡Œæ—¶åœ¨å†…å­˜ä¸­â€œä¸´æ—¶â€ç”Ÿæˆ AOP åŠ¨æ€ä»£ç†ç±»**ï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä¸ºè¿è¡Œæ—¶å¢å¼ºã€‚ç›®å‰ Spring ä¸­ä½¿ç”¨äº†ä¸¤ç§åŠ¨æ€ä»£ç†åº“ï¼š

  - JDK åŠ¨æ€ä»£ç†
  - CGLIB

é‚£ä¹ˆ Spring ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†ï¼Œä»€ä¹ˆæ—¶å€™ä½¿ç”¨ CGLIB å‘¢ï¼Ÿ



- å¦‚æœè¢«ä»£ç†çš„ç›®æ ‡å¯¹è±¡å®ç°äº†è‡³å°‘ä¸€ä¸ªæ¥å£ï¼Œåˆ™ä¼šä½¿ç”¨ JDK åŠ¨æ€ä»£ç†ã€‚æ‰€æœ‰è¯¥ç›®æ ‡ç±»å‹å®ç°çš„æ¥å£éƒ½è®²è¢«ä»£ç†ã€‚
- è‹¥è¯¥ç›®æ ‡å¯¹è±¡æ²¡æœ‰å®ç°ä»»ä½•æ¥å£ï¼Œåˆ™åˆ›å»ºä¸€ä¸ª CGLIB ä»£ç†ã€‚

æˆ–è€…ï¼Œæˆ‘ä»¬æ¥æ¢ä¸€ä¸ªè§£ç­”ç­”æ¡ˆï¼š

Spring AOP ä¸­çš„åŠ¨æ€ä»£ç†ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼Œ

- JDK åŠ¨æ€ä»£ç†

  JDK åŠ¨æ€ä»£ç†é€šè¿‡**åå°„**æ¥æ¥æ”¶è¢«ä»£ç†çš„ç±»ï¼Œå¹¶ä¸”è¦æ±‚è¢«ä»£ç†çš„ç±»**å¿…é¡»å®ç°ä¸€ä¸ªæ¥å£**ã€‚JDKåŠ¨æ€ä»£ç†çš„æ ¸å¿ƒæ˜¯ InvocationHandler æ¥å£å’Œ Proxy ç±»ã€‚

- CGLIB åŠ¨æ€ä»£ç†

  **å¦‚æœç›®æ ‡ç±»æ²¡æœ‰å®ç°æ¥å£**ï¼Œé‚£ä¹ˆ Spring AOP ä¼šé€‰æ‹©ä½¿ç”¨ CGLIB æ¥åŠ¨æ€ä»£ç†ç›®æ ‡ç±»ã€‚
  CGLIBï¼ˆCode Generation Libraryï¼‰ï¼Œæ˜¯ä¸€ä¸ªä»£ç ç”Ÿæˆçš„ç±»åº“ï¼Œå¯ä»¥åœ¨**è¿è¡Œæ—¶åŠ¨æ€çš„ç”ŸæˆæŸä¸ªç±»çš„å­ç±»**ï¼Œæ³¨æ„ï¼ŒCGLIB æ˜¯é€šè¿‡**ç»§æ‰¿çš„æ–¹å¼åšçš„åŠ¨æ€ä»£ç†**ï¼Œå› æ­¤å¦‚æœæŸä¸ªç±»è¢«æ ‡è®°ä¸º `final` ï¼Œé‚£ä¹ˆå®ƒæ˜¯æ— æ³•ä½¿ç”¨ CGLIB åšåŠ¨æ€ä»£ç†çš„ã€‚

## Spring AOP and AspectJ AOP æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

- ä»£ç†æ–¹å¼ä¸åŒ
  - Spring AOP åŸºäºåŠ¨æ€ä»£ç†æ–¹å¼å®ç°ã€‚
  - AspectJ AOP åŸºäºé™æ€ä»£ç†æ–¹å¼å®ç°ã€‚
- PointCut æ”¯æŒåŠ›åº¦ä¸åŒ
  - Spring AOP **ä»…**æ”¯æŒæ–¹æ³•çº§åˆ«çš„ PointCut ã€‚
  - AspectJ AOP æä¾›äº†å®Œå…¨çš„ AOP æ”¯æŒï¼Œå®ƒè¿˜æ”¯æŒå±æ€§çº§åˆ«çš„ PointCut ã€‚

## ä»€ä¹ˆæ˜¯ç¼–ç»‡ï¼ˆWeavingï¼‰ï¼Ÿ

Weaving ï¼Œ**ç¼–ç»‡**ã€‚

- ä¸ºäº†åˆ›å»ºä¸€ä¸ª Advice å¯¹è±¡è€Œé“¾æ¥ä¸€ä¸ª Aspect å’Œå…¶å®ƒåº”ç”¨ç±»å‹æˆ–å¯¹è±¡ï¼Œç§°ä¸ºç¼–ç»‡ï¼ˆWeavingï¼‰ã€‚
- åœ¨ Spring AOP ä¸­ï¼Œç¼–ç»‡åœ¨**è¿è¡Œæ—¶æ‰§è¡Œï¼Œå³åŠ¨æ€ä»£ç†**ã€‚è¯·å‚è€ƒä¸‹å›¾ï¼š[![Proxy](http://static2.iocoder.cn/images/Spring/2018-12-24/05.jpg)](http://static2.iocoder.cn/images/Spring/2018-12-24/05.jpg)Proxy

## Spring å¦‚ä½•ä½¿ç”¨ AOP åˆ‡é¢ï¼Ÿ

åœ¨ Spring AOP ä¸­ï¼Œæœ‰ä¸¤ç§æ–¹å¼é…ç½® AOP åˆ‡é¢ï¼š

- åŸºäº **XML** æ–¹å¼çš„åˆ‡é¢å®ç°ã€‚
- åŸºäº **æ³¨è§£** æ–¹å¼çš„åˆ‡é¢å®ç°ã€‚

# Spring Transaction

éå¸¸æ¨èé˜…è¯»å¦‚ä¸‹æ–‡ç« ï¼š

- [ã€Šå¯èƒ½æ˜¯æœ€æ¼‚äº®çš„ Spring äº‹åŠ¡ç®¡ç†è¯¦è§£ã€‹](https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247484702&idx=1&sn=c04261d63929db09ff6df7cadc7cca21&chksm=fa497aafcd3ef3b94082da7bca841b5b7b528eb2a52dbc4eb647b97be63a9a1cf38a9e71bf90&token=165108535&lang=zh_CN#rd)

## ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ

äº‹åŠ¡å°±æ˜¯å¯¹ä¸€ç³»åˆ—çš„æ•°æ®åº“æ“ä½œï¼ˆæ¯”å¦‚æ’å…¥å¤šæ¡æ•°æ®ï¼‰è¿›è¡Œç»Ÿä¸€çš„æäº¤æˆ–å›æ»šæ“ä½œï¼Œå¦‚æœæ’å…¥æˆåŠŸï¼Œé‚£ä¹ˆä¸€èµ·æˆåŠŸï¼Œå¦‚æœä¸­é—´æœ‰ä¸€æ¡å‡ºç°å¼‚å¸¸ï¼Œé‚£ä¹ˆå›æ»šä¹‹å‰çš„æ‰€æœ‰æ“ä½œã€‚

è¿™æ ·å¯ä»¥é˜²æ­¢å‡ºç°è„æ•°æ®ï¼Œé˜²æ­¢æ•°æ®åº“æ•°æ®å‡ºç°é—®é¢˜ã€‚

## äº‹åŠ¡çš„ç‰¹æ€§æŒ‡çš„æ˜¯ï¼Ÿ

æŒ‡çš„æ˜¯ **ACID** ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

[![äº‹åŠ¡çš„ç‰¹æ€§](http://static2.iocoder.cn/images/Spring/2018-12-24/06.png)](http://static2.iocoder.cn/images/Spring/2018-12-24/06.png)äº‹åŠ¡çš„ç‰¹æ€§

1. **åŸå­æ€§** Atomicity ï¼šä¸€ä¸ªäº‹åŠ¡ï¼ˆtransactionï¼‰ä¸­çš„æ‰€æœ‰æ“ä½œï¼Œæˆ–è€…å…¨éƒ¨å®Œæˆï¼Œæˆ–è€…å…¨éƒ¨ä¸å®Œæˆï¼Œä¸ä¼šç»“æŸåœ¨ä¸­é—´æŸä¸ªç¯èŠ‚ã€‚äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œä¼šè¢«æ¢å¤ï¼ˆRollbackï¼‰åˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ï¼Œå°±åƒè¿™ä¸ªäº‹åŠ¡ä»æ¥æ²¡æœ‰æ‰§è¡Œè¿‡ä¸€æ ·ã€‚å³ï¼Œäº‹åŠ¡ä¸å¯åˆ†å‰²ã€ä¸å¯çº¦ç®€ã€‚
2. **ä¸€è‡´æ€§** Consistency ï¼šåœ¨äº‹åŠ¡å¼€å§‹ä¹‹å‰å’Œäº‹åŠ¡ç»“æŸä»¥åï¼Œæ•°æ®åº“çš„å®Œæ•´æ€§æ²¡æœ‰è¢«ç ´åã€‚è¿™è¡¨ç¤ºå†™å…¥çš„èµ„æ–™å¿…é¡»å®Œå…¨ç¬¦åˆæ‰€æœ‰çš„é¢„è®¾[çº¦æŸ](https://zh.wikipedia.org/wiki/æ•°æ®å®Œæ•´æ€§)ã€[è§¦å‘å™¨](https://zh.wikipedia.org/wiki/è§¦å‘å™¨_(æ•°æ®åº“))ã€[çº§è”å›æ»š](https://zh.wikipedia.org/w/index.php?title=çº§è”å›æ»š&action=edit&redlink=1)ç­‰ã€‚
3. **éš”ç¦»æ€§** Isolation ï¼šæ•°æ®åº“å…è®¸å¤šä¸ªå¹¶å‘äº‹åŠ¡åŒæ—¶å¯¹å…¶æ•°æ®è¿›è¡Œè¯»å†™å’Œä¿®æ”¹çš„èƒ½åŠ›ï¼Œéš”ç¦»æ€§å¯ä»¥é˜²æ­¢å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶ç”±äºäº¤å‰æ‰§è¡Œè€Œå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´ã€‚äº‹åŠ¡éš”ç¦»åˆ†ä¸ºä¸åŒçº§åˆ«ï¼ŒåŒ…æ‹¬è¯»æœªæäº¤ï¼ˆRead uncommittedï¼‰ã€è¯»æäº¤ï¼ˆread committedï¼‰ã€å¯é‡å¤è¯»ï¼ˆrepeatable readï¼‰å’Œä¸²è¡ŒåŒ–ï¼ˆSerializableï¼‰ã€‚
4. **æŒä¹…æ€§** Durability ï¼šäº‹åŠ¡å¤„ç†ç»“æŸåï¼Œå¯¹æ•°æ®çš„ä¿®æ”¹å°±æ˜¯æ°¸ä¹…çš„ï¼Œå³ä¾¿ç³»ç»Ÿæ•…éšœä¹Ÿä¸ä¼šä¸¢å¤±ã€‚

## åˆ—ä¸¾ Spring æ”¯æŒçš„äº‹åŠ¡ç®¡ç†ç±»å‹ï¼Ÿ

ç›®å‰ Spring æä¾›ä¸¤ç§ç±»å‹çš„äº‹åŠ¡ç®¡ç†ï¼š

- **å£°æ˜å¼**äº‹åŠ¡ï¼šé€šè¿‡ä½¿ç”¨æ³¨è§£æˆ–åŸºäº XML çš„é…ç½®äº‹åŠ¡ï¼Œä»è€Œäº‹åŠ¡ç®¡ç†ä¸ä¸šåŠ¡ä»£ç åˆ†ç¦»ã€‚
- **ç¼–ç¨‹å¼**äº‹åŠ¡ï¼šé€šè¿‡ç¼–ç çš„æ–¹å¼å®ç°äº‹åŠ¡ç®¡ç†ï¼Œéœ€è¦åœ¨ä»£ç ä¸­æ˜¾å¼çš„è°ƒç”¨äº‹åŠ¡çš„è·å¾—ã€æäº¤ã€å›æ»šã€‚å®ƒä¸ºæ‚¨æä¾›æå¤§çš„çµæ´»æ€§ï¼Œä½†ç»´æŠ¤èµ·æ¥éå¸¸å›°éš¾ã€‚

å®é™…åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨ Spring Boot + æ³¨è§£çš„**å£°æ˜å¼**äº‹åŠ¡ã€‚å…·ä½“çš„ç¤ºä¾‹ï¼Œèƒ–å‹å¯ä»¥çœ‹çœ‹ [ã€ŠSpring Boot äº‹åŠ¡æ³¨è§£è¯¦è§£ã€‹](https://www.jianshu.com/p/cddeca2c9245) ã€‚

å¦å¤–ï¼Œä¹Ÿæ¨èçœ‹çœ‹ [ã€ŠSpring äº‹åŠ¡ç®¡ç† ï¼ ç¼–ç¨‹å¼äº‹åŠ¡ã€å£°æ˜å¼äº‹åŠ¡ã€‹](https://blog.csdn.net/xktxoo/article/details/77919508) ä¸€æ–‡ã€‚

## Spring äº‹åŠ¡å¦‚ä½•å’Œä¸åŒçš„æ•°æ®æŒä¹…å±‚æ¡†æ¶åšé›†æˆï¼Ÿ

â‘  é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆæ˜ç¡®ä¸‹ï¼Œè¿™é‡Œæ•°æ®æŒä¹…å±‚æ¡†æ¶ï¼ŒæŒ‡çš„æ˜¯ Spring JDBCã€Hibernateã€Spring JPAã€MyBatis ç­‰ç­‰ã€‚

â‘¡ ç„¶åï¼ŒSpring äº‹åŠ¡çš„ç®¡ç†ï¼Œæ˜¯é€šè¿‡ `org.springframework.transaction.PlatformTransactionManager` è¿›è¡Œç®¡ç†ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š

```
// PlatformTransactionManager.java

public interface PlatformTransactionManager {

    // æ ¹æ®äº‹åŠ¡å®šä¹‰ TransactionDefinition ï¼Œè·å¾— TransactionStatus ã€‚ 
    TransactionStatus getTransaction(@Nullable TransactionDefinition definition) throws TransactionException;

    // æ ¹æ®æƒ…å†µï¼Œæäº¤äº‹åŠ¡
    void commit(TransactionStatus status) throws TransactionException;
    
    // æ ¹æ®æƒ…å†µï¼Œå›æ»šäº‹åŠ¡
    void rollback(TransactionStatus status) throws TransactionException;
    
}
```

- PlatformTransactionManager æ˜¯è´Ÿè´£äº‹åŠ¡ç®¡ç†çš„æ¥å£ï¼Œä¸€å…±æœ‰ä¸‰ä¸ªæ¥å£æ–¹æ³•ï¼Œåˆ†åˆ«è´Ÿè´£äº‹åŠ¡çš„è·å¾—ã€æäº¤ã€å›æ»šã€‚

- ```
  #getTransaction(TransactionDefinition definition)
  ```

   

  æ–¹æ³•ï¼Œæ ¹æ®äº‹åŠ¡å®šä¹‰ TransactionDefinition ï¼Œè·å¾— TransactionStatus ã€‚

  - ä¸ºä»€ä¹ˆä¸æ˜¯åˆ›å»ºäº‹åŠ¡å‘¢ï¼Ÿå› ä¸ºå¦‚æœå½“å‰å¦‚æœå·²ç»æœ‰äº‹åŠ¡ï¼Œåˆ™ä¸ä¼šè¿›è¡Œåˆ›å»ºï¼Œä¸€èˆ¬æ¥è¯´ä¼šè·Ÿå½“å‰çº¿ç¨‹è¿›è¡Œç»‘å®šã€‚å¦‚æœä¸å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™è¿›è¡Œåˆ›å»ºã€‚
  - ä¸ºä»€ä¹ˆè¿”å›çš„æ˜¯ TransactionStatus å¯¹è±¡ï¼Ÿåœ¨ TransactionStatus ä¸­ï¼Œä¸ä»…ä»…åŒ…å«äº‹åŠ¡å±æ€§ï¼Œè¿˜åŒ…å«äº‹åŠ¡çš„å…¶å®ƒä¿¡æ¯ï¼Œä¾‹å¦‚æ˜¯å¦åªè¯»ã€æ˜¯å¦ä¸ºæ–°åˆ›å»ºçš„äº‹åŠ¡ç­‰ç­‰ã€‚ğŸ˜ˆ ä¸‹é¢ï¼Œä¹Ÿä¼šè¯¦ç»†è§£æ TransactionStatus ã€‚
  - äº‹åŠ¡ TransactionDefinition æ˜¯ä»€ä¹ˆï¼ŸğŸ˜ˆ ä¸‹é¢ï¼Œä¹Ÿä¼šè¯¦ç»†è§£æ TransactionStatus ã€‚

- ```
  #commit(TransactionStatus status)
  ```

   

  æ–¹æ³•ï¼Œæ ¹æ® TransactionStatus æƒ…å†µï¼Œæäº¤äº‹åŠ¡ã€‚

  - ä¸ºä»€ä¹ˆæ ¹æ® TransactionStatus æƒ…å†µï¼Œè¿›è¡Œæäº¤ï¼Ÿä¾‹å¦‚è¯´ï¼Œå¸¦

    ```
    @Transactional
    ```

     

    æ³¨è§£çš„çš„ A æ–¹æ³•ï¼Œä¼šè°ƒç”¨

     

    ```
    @Transactional
    ```

     

    æ³¨è§£çš„çš„ B æ–¹æ³•ã€‚

    - åœ¨ B æ–¹æ³•ç»“æŸè°ƒç”¨åï¼Œä¼šæ‰§è¡Œ `PlatformTransactionManager#commit(TransactionStatus status)` æ–¹æ³•ï¼Œæ­¤å¤„äº‹åŠ¡**æ˜¯ä¸èƒ½**ã€**ä¹Ÿä¸ä¼š**æäº¤çš„ã€‚
    - è€Œæ˜¯åœ¨ A æ–¹æ³•ç»“æŸè°ƒç”¨åï¼Œæ‰§è¡Œ `PlatformTransactionManager#commit(TransactionStatus status)` æ–¹æ³•ï¼Œæäº¤äº‹åŠ¡ã€‚

- ```
  #rollback(TransactionStatus status)
  ```

   

  æ–¹æ³•ï¼Œæ ¹æ® TransactionStatus æƒ…å†µï¼Œå›æ»šäº‹åŠ¡ã€‚

  - ä¸ºä»€ä¹ˆæ ¹æ® TransactionStatus æƒ…å†µï¼Œè¿›è¡Œå›æ»šï¼ŸåŸå› åŒ `#commit(TransactionStatus status)` æ–¹æ³•ã€‚

â‘¢ å†ä¹‹åï¼ŒPlatformTransactionManager æœ‰**æŠ½è±¡å­**ç±» `org.springframework.transaction.support.AbstractPlatformTransactionManager` ï¼ŒåŸºäº [æ¨¡æ¿æ–¹æ³•æ¨¡å¼](https://blog.csdn.net/carson_ho/article/details/54910518) ï¼Œå®ç°äº‹åŠ¡æ•´ä½“é€»è¾‘çš„éª¨æ¶ï¼Œè€ŒæŠ½è±¡ `#doCommit(DefaultTransactionStatus status)`ã€`#doRollback(DefaultTransactionStatus status)` ç­‰ç­‰æ–¹æ³•ï¼Œäº¤ç”±å­ç±»ç±»æ¥å®ç°ã€‚

> å‰æ–¹é«˜èƒ½ï¼Œå³å°†è¿›å…¥å…³é”®çš„ â‘£ æ­¥éª¤ã€‚

â‘£ æœ€åï¼Œä¸åŒçš„æ•°æ®æŒä¹…å±‚æ¡†æ¶ï¼Œä¼šæœ‰å…¶å¯¹åº”çš„ PlatformTransactionManager å®ç°ç±»ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š[![äº‹åŠ¡çš„ç‰¹æ€§](http://static2.iocoder.cn/images/Spring/2018-12-24/07.png)](http://static2.iocoder.cn/images/Spring/2018-12-24/07.png)äº‹åŠ¡çš„ç‰¹æ€§

- æ‰€æœ‰çš„å®ç°ç±»ï¼Œéƒ½åŸºäº AbstractPlatformTransactionManager è¿™ä¸ªéª¨æ¶ç±»ã€‚
- HibernateTransactionManager ï¼Œå’Œ Hibernate5 çš„äº‹åŠ¡ç®¡ç†åšé›†æˆã€‚
- DataSourceTransactionManager ï¼Œå’Œ JDBC çš„äº‹åŠ¡ç®¡ç†åšé›†æˆã€‚æ‰€ä»¥ï¼Œå®ƒä¹Ÿé€‚ç”¨äº MyBatisã€Spring JDBC ç­‰ç­‰ã€‚
- JpaTransactionManager ï¼Œå’Œ JPA çš„äº‹åŠ¡ç®¡ç†åšé›†æˆã€‚

å¦‚ä¸‹ï¼Œæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„ XML æ–¹å¼æ¥é…ç½®çš„äº‹åŠ¡ç®¡ç†å™¨ï¼Œä½¿ç”¨çš„æ˜¯ DataSourceTransactionManager ã€‚ä»£ç å¦‚ä¸‹ï¼š

```
<!-- äº‹åŠ¡ç®¡ç†å™¨ -->
<bean id="transactionManager"
class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
    <!-- æ•°æ®æº -->
    <property name="dataSource" ref="dataSource" />
</bean>
```

- æ­£å¦‚ä¸Šæ–‡æ‰€è¯´ï¼Œå®ƒé€‚ç”¨äº MyBatisã€Spring JDBC ç­‰ç­‰ã€‚

------

ğŸ˜ˆ æ˜¯ä¸æ˜¯å¾ˆæœ‰è¶£ï¼Œæ›´å¤šè¯¦ç»†çš„è§£æï¼Œå¯è§å¦‚ä¸‹å‡ ç¯‡æ–‡ç« ï¼š

- [ã€Šç²¾å°½ Spring æºç åˆ†æ â€”â€” Transaction æºç ç®€å•å¯¼è¯»ã€‹](http://svip.iocoder.cn/categories/Spring/)
- [ã€Šç²¾å°½ MyBatis æºç åˆ†æ â€”â€” äº‹åŠ¡æ¨¡å—ã€‹](http://svip.iocoder.cn/MyBatis/transaction-package/)
- [ã€Šç²¾å°½ MyBatis æºç è§£æ â€”â€” Spring é›†æˆï¼ˆå››ï¼‰ä¹‹äº‹åŠ¡ã€‹](http://svip.iocoder.cn/MyBatis/Spring-Integration-4/)

## ä¸ºä»€ä¹ˆåœ¨ Spring äº‹åŠ¡ä¸­ä¸èƒ½åˆ‡æ¢æ•°æ®æºï¼Ÿ

åšè¿‡ Spring å¤šæ•°æ®æºçš„èƒ–å‹ï¼Œéƒ½ä¼šæœ‰ä¸ªæƒ¨ç—›çš„ç»å†ï¼Œä¸ºä»€ä¹ˆåœ¨å¼€å¯äº‹åŠ¡çš„ Service å±‚çš„æ–¹æ³•ä¸­ï¼Œæ— æ³•åˆ‡æ¢æ•°æ®æºå‘¢ï¼Ÿå› ä¸ºï¼Œåœ¨ Spring çš„äº‹åŠ¡ç®¡ç†ä¸­ï¼Œ**æ‰€ä½¿ç”¨çš„æ•°æ®åº“è¿æ¥ä¼šå’Œå½“å‰çº¿ç¨‹æ‰€ç»‘å®š**ï¼Œå³ä½¿æˆ‘ä»¬è®¾ç½®äº†å¦å¤–ä¸€ä¸ªæ•°æ®æºï¼Œä½¿ç”¨çš„è¿˜æ˜¯å½“å‰çš„æ•°æ®æºè¿æ¥ã€‚

å¦å¤–ï¼Œå¤šä¸ªæ•°æ®æºä¸”éœ€è¦äº‹åŠ¡çš„åœºæ™¯ï¼Œæœ¬èº«ä¼šå¸¦æ¥**å¤šäº‹åŠ¡ä¸€è‡´æ€§**çš„é—®é¢˜ï¼Œæš‚æ—¶æ²¡æœ‰ç‰¹åˆ«å¥½çš„è§£å†³æ–¹æ¡ˆã€‚

æ‰€ä»¥ä¸€èˆ¬ä¸€ä¸ªåº”ç”¨ï¼Œæ¨èé™¤éäº†è¯»å†™åˆ†ç¦»æ‰€å¸¦æ¥çš„å¤šæ•°æ®æºï¼Œå…¶å®ƒæƒ…å†µä¸‹ï¼Œå»ºè®®åªæœ‰ä¸€ä¸ªæ•°æ®æºã€‚å¹¶ä¸”ï¼Œéšç€å¾®æœåŠ¡æ—¥ç›Šèº«å½¢ï¼Œä¸€ä¸ªæœåŠ¡å¯¹åº”ä¸€ä¸ª DB æ˜¯æ¯”è¾ƒå¸¸è§çš„æ¶æ„é€‰æ‹©ã€‚

## @Transactional æ³¨è§£æœ‰å“ªäº›å±æ€§ï¼Ÿå¦‚ä½•ä½¿ç”¨ï¼Ÿ

`@Transactional` æ³¨è§£çš„**å±æ€§**å¦‚ä¸‹ï¼š

| å±æ€§                   | ç±»å‹                               | æè¿°                                   |
| :--------------------- | :--------------------------------- | :------------------------------------- |
| value                  | String                             | å¯é€‰çš„é™å®šæè¿°ç¬¦ï¼ŒæŒ‡å®šä½¿ç”¨çš„äº‹åŠ¡ç®¡ç†å™¨ |
| propagation            | enum: Propagation                  | å¯é€‰çš„äº‹åŠ¡ä¼ æ’­è¡Œä¸ºè®¾ç½®                 |
| isolation              | enum: Isolation                    | å¯é€‰çš„äº‹åŠ¡éš”ç¦»çº§åˆ«è®¾ç½®                 |
| readOnly               | boolean                            | è¯»å†™æˆ–åªè¯»äº‹åŠ¡ï¼Œé»˜è®¤è¯»å†™               |
| timeout                | int (in seconds granularity)       | äº‹åŠ¡è¶…æ—¶æ—¶é—´è®¾ç½®                       |
| rollbackFor            | Classå¯¹è±¡æ•°ç»„ï¼Œå¿…é¡»ç»§æ‰¿è‡ªThrowable | å¯¼è‡´äº‹åŠ¡å›æ»šçš„å¼‚å¸¸ç±»æ•°ç»„               |
| rollbackForClassName   | ç±»åæ•°ç»„ï¼Œå¿…é¡»ç»§æ‰¿è‡ªThrowable      | å¯¼è‡´äº‹åŠ¡å›æ»šçš„å¼‚å¸¸ç±»åå­—æ•°ç»„           |
| noRollbackFor          | Classå¯¹è±¡æ•°ç»„ï¼Œå¿…é¡»ç»§æ‰¿è‡ªThrowable | ä¸ä¼šå¯¼è‡´äº‹åŠ¡å›æ»šçš„å¼‚å¸¸ç±»æ•°ç»„           |
| noRollbackForClassName | ç±»åæ•°ç»„ï¼Œå¿…é¡»ç»§æ‰¿è‡ªThrowable      | ä¸ä¼šå¯¼è‡´äº‹åŠ¡å›æ»šçš„å¼‚å¸¸ç±»åå­—æ•°ç»„       |

- ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨ `@Transactional` çš„æ‰€æœ‰å±æ€§é»˜è®¤å€¼å³å¯ã€‚

å…·ä½“**ç”¨æ³•**å¦‚ä¸‹ï¼š

- `@Transactional` å¯ä»¥ä½œç”¨äºæ¥å£ã€æ¥å£æ–¹æ³•ã€ç±»ä»¥åŠç±»æ–¹æ³•ä¸Šã€‚å½“ä½œç”¨äºç±»ä¸Šæ—¶ï¼Œè¯¥ç±»çš„æ‰€æœ‰ `public` æ–¹æ³•å°†éƒ½å…·æœ‰è¯¥ç±»å‹çš„äº‹åŠ¡å±æ€§ï¼ŒåŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨æ–¹æ³•çº§åˆ«ä½¿ç”¨è¯¥æ ‡æ³¨æ¥è¦†ç›–ç±»çº§åˆ«çš„å®šä¹‰ã€‚
- è™½ç„¶ `@Transactional` æ³¨è§£å¯ä»¥ä½œç”¨äºæ¥å£ã€æ¥å£æ–¹æ³•ã€ç±»ä»¥åŠç±»æ–¹æ³•ä¸Šï¼Œä½†æ˜¯ Spring å»ºè®®ä¸è¦åœ¨æ¥å£æˆ–è€…æ¥å£æ–¹æ³•ä¸Šä½¿ç”¨è¯¥æ³¨è§£ï¼Œå› ä¸ºè¿™åªæœ‰åœ¨ä½¿ç”¨åŸºäºæ¥å£çš„ä»£ç†æ—¶å®ƒæ‰ä¼šç”Ÿæ•ˆã€‚å¦å¤–ï¼Œ **`@Transactional` æ³¨è§£åº”è¯¥åªè¢«åº”ç”¨åˆ° `public` æ–¹æ³•ä¸Šï¼Œè¿™æ˜¯ç”± Spring AOP çš„æœ¬è´¨å†³å®šçš„**ã€‚å¦‚æœä½ åœ¨ `protected`ã€`private` æˆ–è€…é»˜è®¤å¯è§æ€§çš„æ–¹æ³•ä¸Šä½¿ç”¨ `@Transactional` æ³¨è§£ï¼Œè¿™å°†è¢«å¿½ç•¥ï¼Œä¹Ÿä¸ä¼šæŠ›å‡ºä»»ä½•å¼‚å¸¸ã€‚**è¿™ä¸€ç‚¹ï¼Œéå¸¸éœ€è¦æ³¨æ„**ã€‚

------

ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥ç®€å•è¯´ä¸‹**æºç **ç›¸å…³çš„ä¸œè¥¿ã€‚

`@Transactional` æ³¨è§£çš„å±æ€§ï¼Œä¼šè§£ææˆ `org.springframework.transaction.TransactionDefinition` å¯¹è±¡ï¼Œå³äº‹åŠ¡å®šä¹‰ã€‚TransactionDefinition ä»£ç å¦‚ä¸‹ï¼š

```
public interface TransactionDefinition {

	int getPropagationBehavior(); // äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸º
	int getIsolationLevel(); // äº‹åŠ¡çš„éš”ç¦»çº§åˆ«
	int getTimeout(); // äº‹åŠ¡çš„è¶…æ—¶æ—¶é—´
	boolean isReadOnly(); // äº‹åŠ¡æ˜¯å¦åªè¯»
	@Nullable
	String getName(); // äº‹åŠ¡çš„åå­—

}
```

- å¯èƒ½ä¼šèƒ–å‹æœ‰ä»¥åï¼Œ`@Transactional` æ³¨è§£çš„ `rollbackFor`ã€`rollbackForClassName`ã€`noRollbackFor`ã€`noRollbackForClassName` å±æ€§è²Œä¼¼æ²¡ä½“ç°å‡ºæ¥ï¼Ÿå®ƒä»¬æç°åœ¨ TransactionDefinition çš„å®ç°ç±» RuleBasedTransactionAttribute ä¸­ã€‚
- `#getPropagationBehavior()` æ–¹æ³•ï¼Œè¿”å›äº‹åŠ¡çš„**ä¼ æ’­è¡Œä¸º**ï¼Œè¯¥å€¼æ˜¯ä¸ªæšä¸¾ï¼Œåœ¨ä¸‹é¢æ¥è¯´ã€‚
- `#getIsolationLevel()` æ–¹æ³•ï¼Œè¿”å›äº‹åŠ¡çš„**éš”ç¦»çº§åˆ«**ï¼Œè¯¥å€¼æ˜¯ä¸ªæšä¸¾ï¼Œåœ¨ä¸‹é¢æ¥è¯´ã€‚

## ä»€ä¹ˆæ˜¯äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Ÿåˆ†æˆå“ªäº›éš”ç¦»çº§åˆ«ï¼Ÿ

å…³äºè¿™ä¸ªé—®é¢˜ï¼Œæ¶‰åŠçš„å†…å®¹ä¼šæ¯”è¾ƒå¤šï¼Œèƒ–å‹ç›´æ¥çœ‹å¦‚ä¸‹ä¸¤ç¯‡æ–‡ç« ï¼š

- [ã€Šæ•°æ®åº“å››å¤§ç‰¹æ€§ä»¥åŠäº‹åŠ¡éš”ç¦»çº§åˆ«ã€‹](https://zhuanlan.zhihu.com/p/25419593)
- [ã€Šäº”åˆ†é’Ÿææ¸…æ¥š MySQL äº‹åŠ¡éš”ç¦»çº§åˆ«ã€‹](https://www.jianshu.com/p/4e3edbedb9a8)

å¦å¤–ï¼Œæœ‰ä¸€ç‚¹éå¸¸é‡è¦ï¼Œä¸åŒæ•°æ®åº“å¯¹å››ä¸ªéš”ç¦»çº§åˆ«çš„æ”¯æŒå’Œå®ç°ç•¥æœ‰ä¸åŒã€‚å› ä¸ºæˆ‘ä»¬ç›®å‰äº’è”ç½‘ä¸»è¦ä½¿ç”¨ MySQL ä¸ºä¸»ï¼Œæ‰€ä»¥è‡³å°‘è¦ææ‡‚ MySQL å¯¹éš”ç¦»çº§åˆ«çš„æ”¯æŒå’Œå®ç°æƒ…å†µã€‚

åœ¨ TransactionDefinition æ¥å£ä¸­ï¼Œå®šä¹‰äº†â€œ**å››ç§**â€çš„éš”ç¦»çº§åˆ«æšä¸¾ã€‚ä»£ç å¦‚ä¸‹ï¼š

```
// TransactionDefinition.java

/**
 * ã€Spring ç‹¬æœ‰ã€‘ä½¿ç”¨åç«¯æ•°æ®åº“é»˜è®¤çš„éš”ç¦»çº§åˆ«
 *
 * MySQL é»˜è®¤é‡‡ç”¨çš„ REPEATABLE_READéš”ç¦»çº§åˆ«
 * Oracle é»˜è®¤é‡‡ç”¨çš„ READ_COMMITTEDéš”ç¦»çº§åˆ«
 */
int ISOLATION_DEFAULT = -1;

/**
 * æœ€ä½çš„éš”ç¦»çº§åˆ«ï¼Œå…è®¸è¯»å–å°šæœªæäº¤çš„æ•°æ®å˜æ›´ï¼Œå¯èƒ½ä¼šå¯¼è‡´è„è¯»ã€å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»
 */
int ISOLATION_READ_UNCOMMITTED = Connection.TRANSACTION_READ_UNCOMMITTED;

/**
 * å…è®¸è¯»å–å¹¶å‘äº‹åŠ¡å·²ç»æäº¤çš„æ•°æ®ï¼Œå¯ä»¥é˜»æ­¢è„è¯»ï¼Œä½†æ˜¯å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿ
 */
int ISOLATION_READ_COMMITTED = Connection.TRANSACTION_READ_COMMITTED;
/**
 * å¯¹åŒä¸€å­—æ®µçš„å¤šæ¬¡è¯»å–ç»“æœéƒ½æ˜¯ä¸€è‡´çš„ï¼Œé™¤éæ•°æ®æ˜¯è¢«æœ¬èº«äº‹åŠ¡è‡ªå·±æ‰€ä¿®æ”¹ï¼Œå¯ä»¥é˜»æ­¢è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œä½†å¹»è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿã€‚
 */
int ISOLATION_REPEATABLE_READ = Connection.TRANSACTION_REPEATABLE_READ;
/**
 * æœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå®Œå…¨æœä»ACIDçš„éš”ç¦»çº§åˆ«ã€‚æ‰€æœ‰çš„äº‹åŠ¡ä¾æ¬¡é€ä¸ªæ‰§è¡Œï¼Œè¿™æ ·äº‹åŠ¡ä¹‹é—´å°±å®Œå…¨ä¸å¯èƒ½äº§ç”Ÿå¹²æ‰°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥çº§åˆ«å¯ä»¥é˜²æ­¢è„è¯»ã€ä¸å¯é‡å¤è¯»ä»¥åŠå¹»è¯»ã€‚
 *
 * ä½†æ˜¯è¿™å°†ä¸¥é‡å½±å“ç¨‹åºçš„æ€§èƒ½ã€‚é€šå¸¸æƒ…å†µä¸‹ä¹Ÿä¸ä¼šç”¨åˆ°è¯¥çº§åˆ«ã€‚
 */
int ISOLATION_SERIALIZABLE = Connection.TRANSACTION_SERIALIZABLE;
```

## ä»€ä¹ˆæ˜¯äº‹åŠ¡çš„ä¼ æ’­çº§åˆ«ï¼Ÿåˆ†æˆå“ªäº›ä¼ æ’­çº§åˆ«ï¼Ÿ

äº‹åŠ¡çš„**ä¼ æ’­è¡Œä¸º**ï¼ŒæŒ‡çš„æ˜¯å½“å‰å¸¦æœ‰äº‹åŠ¡é…ç½®çš„æ–¹æ³•ï¼Œéœ€è¦æ€ä¹ˆå¤„ç†äº‹åŠ¡ã€‚

- ä¾‹å¦‚ï¼šæ–¹æ³•å¯èƒ½ç»§ç»­åœ¨ç°æœ‰äº‹åŠ¡ä¸­è¿è¡Œï¼Œä¹Ÿå¯èƒ½å¼€å¯ä¸€ä¸ªæ–°äº‹åŠ¡ï¼Œå¹¶åœ¨è‡ªå·±çš„äº‹åŠ¡ä¸­è¿è¡Œã€‚

- æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œäº‹åŠ¡çš„ä¼ æ’­çº§åˆ«ï¼Œå¹¶ä¸æ˜¯æ•°æ®åº“äº‹åŠ¡è§„èŒƒä¸­çš„åè¯ï¼Œ**è€Œæ˜¯ Spring è‡ªèº«æ‰€å®šä¹‰çš„**ã€‚é€šè¿‡äº‹åŠ¡çš„ä¼ æ’­çº§åˆ«ï¼ŒSpring æ‰çŸ¥é“å¦‚ä½•å¤„ç†äº‹åŠ¡ï¼Œæ˜¯åˆ›å»ºä¸€ä¸ªæ–°äº‹åŠ¡å‘¢ï¼Œè¿˜æ˜¯ç»§ç»­ä½¿ç”¨å½“å‰çš„äº‹åŠ¡ã€‚

  > è‰¿è‰¿çš„è‡ªæˆ‘åæ§½ï¼šæ˜¯ä¸æ˜¯æœ‰ç§èƒŒæ¦‚å¿µèƒŒçš„æƒ³å“­

åœ¨ TransactionDefinition æ¥å£ä¸­ï¼Œå®šä¹‰äº†**ä¸‰ç±»ä¸ƒç§**ä¼ æ’­çº§åˆ«ã€‚ä»£ç å¦‚ä¸‹ï¼š

```
// TransactionDefinition.java

// ========== æ”¯æŒå½“å‰äº‹åŠ¡çš„æƒ…å†µ ========== 

/**
 * å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™ä½¿ç”¨è¯¥äº‹åŠ¡ã€‚
 * å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ã€‚
 */
int PROPAGATION_REQUIRED = 0;
/**
 * å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™ä½¿ç”¨è¯¥äº‹åŠ¡ã€‚
 * å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™ä»¥éäº‹åŠ¡çš„æ–¹å¼ç»§ç»­è¿è¡Œã€‚
 */
int PROPAGATION_SUPPORTS = 1;
/**
 * å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™ä½¿ç”¨è¯¥äº‹åŠ¡ã€‚
 * å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚
 */
int PROPAGATION_MANDATORY = 2;

// ========== ä¸æ”¯æŒå½“å‰äº‹åŠ¡çš„æƒ…å†µ ========== 

/**
 * åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ã€‚
 * å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚
 */
int PROPAGATION_REQUIRES_NEW = 3;
/**
 * ä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œã€‚
 * å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚
 */
int PROPAGATION_NOT_SUPPORTED = 4;
/**
 * ä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œã€‚
 * å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚
 */
int PROPAGATION_NEVER = 5;

// ========== å…¶ä»–æƒ…å†µ ========== 

/**
 * å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªäº‹åŠ¡ä½œä¸ºå½“å‰äº‹åŠ¡çš„åµŒå¥—äº‹åŠ¡æ¥è¿è¡Œã€‚
 * å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™ç­‰ä»·äº {@link TransactionDefinition#PROPAGATION_REQUIRED}
 */
int PROPAGATION_NESTED = 6;
```

- åˆ†ç±»ä¹‹åï¼Œå…¶å®è¿˜æ˜¯æ¯”è¾ƒå¥½è®°çš„ã€‚å½“ç„¶ï¼Œç»å¤§æ•°åœºæ™¯ï¼Œæˆ‘ä»¬åªç”¨ `PROPAGATION_REQUIRED` ä¼ æ’­çº§åˆ«ã€‚

- è¿™é‡Œéœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼Œå‰é¢çš„å…­ç§äº‹åŠ¡ä¼ æ’­è¡Œä¸ºæ˜¯ Spring ä» EJB ä¸­å¼•å…¥çš„ï¼Œä»–ä»¬å…±äº«ç›¸åŒçš„æ¦‚å¿µã€‚è€Œ

   

  ```
  PROPAGATION_NESTED
  ```

   

  æ˜¯ Spring æ‰€ç‰¹æœ‰çš„ã€‚

  - ä»¥ `PROPAGATION_NESTED` å¯åŠ¨çš„äº‹åŠ¡å†…åµŒäºå¤–éƒ¨äº‹åŠ¡ä¸­ï¼ˆå¦‚æœå­˜åœ¨å¤–éƒ¨äº‹åŠ¡çš„è¯ï¼‰ï¼Œæ­¤æ—¶ï¼Œå†…åµŒäº‹åŠ¡å¹¶ä¸æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„äº‹åŠ¡ï¼Œå®ƒä¾èµ–äºå¤–éƒ¨äº‹åŠ¡çš„å­˜åœ¨ï¼Œåªæœ‰é€šè¿‡å¤–éƒ¨çš„äº‹åŠ¡æäº¤ï¼Œæ‰èƒ½å¼•èµ·å†…éƒ¨äº‹åŠ¡çš„æäº¤ï¼ŒåµŒå¥—çš„å­äº‹åŠ¡ä¸èƒ½å•ç‹¬æäº¤ã€‚å¦‚æœç†Ÿæ‚‰ JDBC ä¸­çš„ä¿å­˜ç‚¹ï¼ˆSavePointï¼‰çš„æ¦‚å¿µï¼Œé‚£åµŒå¥—äº‹åŠ¡å°±å¾ˆå®¹æ˜“ç†è§£äº†ï¼Œå…¶å®åµŒå¥—çš„å­äº‹åŠ¡å°±æ˜¯ä¿å­˜ç‚¹çš„ä¸€ä¸ªåº”ç”¨ï¼Œä¸€ä¸ªäº‹åŠ¡ä¸­å¯ä»¥åŒ…æ‹¬å¤šä¸ªä¿å­˜ç‚¹ï¼Œæ¯ä¸€ä¸ªåµŒå¥—å­äº‹åŠ¡ã€‚å¦å¤–ï¼Œå¤–éƒ¨äº‹åŠ¡çš„å›æ»šä¹Ÿä¼šå¯¼è‡´åµŒå¥—å­äº‹åŠ¡çš„å›æ»šã€‚
  - ğŸ˜ˆ å½“ç„¶ï¼Œè™½ç„¶ä¸Šé¢ `PROPAGATION_NESTED` æ–‡å­—å¾ˆé•¿ï¼Œå®é™…æˆ‘ä»¬åŸºæœ¬æ²¡ç”¨è¿‡ã€‚æˆ–è€…è¯´ï¼Œå»æ‰åŸºæœ¬ï¼Œæˆ‘ä»¬æ ¹æœ¬æ²¡ç”¨è¿‡ã€‚

## ä»€ä¹ˆæ˜¯äº‹åŠ¡çš„è¶…æ—¶å±æ€§ï¼Ÿ

æ‰€è°“äº‹åŠ¡è¶…æ—¶ï¼Œå°±æ˜¯æŒ‡ä¸€ä¸ªäº‹åŠ¡æ‰€å…è®¸æ‰§è¡Œçš„æœ€é•¿æ—¶é—´ï¼Œå¦‚æœè¶…è¿‡è¯¥æ—¶é—´é™åˆ¶ä½†äº‹åŠ¡è¿˜æ²¡æœ‰å®Œæˆï¼Œåˆ™è‡ªåŠ¨å›æ»šäº‹åŠ¡ã€‚

åœ¨ TransactionDefinition ä¸­ä»¥ `int` çš„å€¼æ¥è¡¨ç¤ºè¶…æ—¶æ—¶é—´ï¼Œå…¶å•ä½æ˜¯ç§’ã€‚

å½“ç„¶ï¼Œè¿™ä¸ªå±æ€§ï¼Œè²Œä¼¼æˆ‘ä»¬åŸºæœ¬ä¹Ÿæ²¡ç”¨è¿‡ã€‚

## ä»€ä¹ˆæ˜¯äº‹åŠ¡çš„åªè¯»å±æ€§ï¼Ÿ

äº‹åŠ¡çš„åªè¯»å±æ€§æ˜¯æŒ‡ï¼Œå¯¹äº‹åŠ¡æ€§èµ„æºè¿›è¡Œåªè¯»æ“ä½œæˆ–è€…æ˜¯è¯»å†™æ“ä½œã€‚

- æ‰€è°“äº‹åŠ¡æ€§èµ„æºå°±æ˜¯æŒ‡é‚£äº›è¢«äº‹åŠ¡ç®¡ç†çš„èµ„æºï¼Œæ¯”å¦‚æ•°æ®æºã€JMS èµ„æºï¼Œä»¥åŠè‡ªå®šä¹‰çš„äº‹åŠ¡æ€§èµ„æºç­‰ç­‰ã€‚
- å¦‚æœç¡®å®šåªå¯¹äº‹åŠ¡æ€§èµ„æºè¿›è¡Œåªè¯»æ“ä½œï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°†äº‹åŠ¡æ ‡å¿—ä¸ºåªè¯»çš„ï¼Œä»¥æé«˜äº‹åŠ¡å¤„ç†çš„æ€§èƒ½ã€‚æ„Ÿå…´è¶£çš„èƒ–å‹ï¼Œå¯ä»¥çœ‹çœ‹ [ã€Šä¸ä½¿ç”¨äº‹åŠ¡å’Œä½¿ç”¨åªè¯»äº‹åŠ¡çš„åŒºåˆ« ã€‹](https://my.oschina.net/uniquejava/blog/80954) ã€‚

åœ¨ TransactionDefinition ä¸­ä»¥ `boolean` ç±»å‹æ¥è¡¨ç¤ºè¯¥äº‹åŠ¡æ˜¯å¦åªè¯»ã€‚

## ä»€ä¹ˆæ˜¯äº‹åŠ¡çš„å›æ»šè§„åˆ™ï¼Ÿ

å›æ»šè§„åˆ™ï¼Œå®šä¹‰äº†å“ªäº›å¼‚å¸¸ä¼šå¯¼è‡´äº‹åŠ¡å›æ»šè€Œå“ªäº›ä¸ä¼šã€‚

- é»˜è®¤æƒ…å†µä¸‹ï¼Œäº‹åŠ¡åªæœ‰é‡åˆ°è¿è¡ŒæœŸå¼‚å¸¸æ—¶æ‰ä¼šå›æ»šï¼Œè€Œåœ¨é‡åˆ°æ£€æŸ¥å‹å¼‚å¸¸æ—¶ä¸ä¼šå›æ»šï¼ˆè¿™ä¸€è¡Œä¸ºä¸EJBçš„å›æ»šè¡Œä¸ºæ˜¯ä¸€è‡´çš„ï¼‰ã€‚
- ä½†æ˜¯ä½ å¯ä»¥å£°æ˜äº‹åŠ¡åœ¨é‡åˆ°ç‰¹å®šçš„æ£€æŸ¥å‹å¼‚å¸¸æ—¶åƒé‡åˆ°è¿è¡ŒæœŸå¼‚å¸¸é‚£æ ·å›æ»šã€‚åŒæ ·ï¼Œä½ è¿˜å¯ä»¥å£°æ˜äº‹åŠ¡é‡åˆ°ç‰¹å®šçš„å¼‚å¸¸ä¸å›æ»šï¼Œå³ä½¿è¿™äº›å¼‚å¸¸æ˜¯è¿è¡ŒæœŸå¼‚å¸¸ã€‚

æ³¨æ„ï¼Œäº‹åŠ¡çš„å›æ»šè§„åˆ™ï¼Œå¹¶ä¸æ˜¯æ•°æ®åº“äº‹åŠ¡è§„èŒƒä¸­çš„åè¯ï¼Œ**è€Œæ˜¯ Spring è‡ªèº«æ‰€å®šä¹‰çš„**ã€‚

## ç®€å•ä»‹ç» TransactionStatus ï¼Ÿ

> è‰¿è‰¿ï¼šè¿™ä¸ªå¯èƒ½ä¸æ˜¯ä¸€ä¸ªé¢è¯•é¢˜ï¼Œä¸»è¦æ»¡è¶³ä¸‹å¤§å®¶çš„å¥½å¥‡å¿ƒã€‚

TransactionStatus æ¥å£ï¼Œè®°å½•äº‹åŠ¡çš„çŠ¶æ€ï¼Œä¸ä»…ä»…åŒ…å«äº‹åŠ¡æœ¬èº«ï¼Œè¿˜åŒ…å«äº‹åŠ¡çš„å…¶å®ƒä¿¡æ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š

```
// TransactionStatus.java

public interface TransactionStatus extends SavepointManager, Flushable {

    /**
     * æ˜¯å¦æ˜¯æ–°åˆ›å»ºçš„äº‹åŠ¡
     */
    boolean isNewTransaction();

    /**
     * æ˜¯å¦æœ‰ Savepoint
     *
     * åœ¨ {@link TransactionDefinition#PROPAGATION_NESTED} ä¼ æ’­çº§åˆ«ä½¿ç”¨ã€‚
     */
    boolean hasSavepoint();

    /**
     * è®¾ç½®ä¸ºåªå›æ»š
     */
    void setRollbackOnly();
    /**
     * æ˜¯å¦ä¸ºåªå›æ»š
     */
    boolean isRollbackOnly();

    /**
     * æ‰§è¡Œ flush æ“ä½œ
     */
    @Override
    void flush();

    /**
     * æ˜¯å¦äº‹åŠ¡å·²ç»å®Œæˆ
     */
    boolean isCompleted();

}
```

- ä¸ºä»€ä¹ˆæ²¡æœ‰äº‹åŠ¡å¯¹è±¡å‘¢ï¼Ÿåœ¨ TransactionStatus çš„å®ç°ç±» DefaultTransactionStatus ä¸­ï¼Œæœ‰ä¸ª `Object transaction` å±æ€§ï¼Œè¡¨ç¤ºäº‹åŠ¡å¯¹è±¡ã€‚
- `#isNewTransaction()` æ–¹æ³•ï¼Œè¡¨ç¤ºæ˜¯å¦æ˜¯æ–°åˆ›å»ºçš„äº‹åŠ¡ã€‚æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿç­”æ¡ˆç»“åˆ [ã€ŒSpring äº‹åŠ¡å¦‚ä½•å’Œä¸åŒçš„æ•°æ®æŒä¹…å±‚æ¡†æ¶åšé›†æˆï¼Ÿã€](http://svip.iocoder.cn/Spring/Interview/#) é—®é¢˜ï¼Œæˆ‘ä»¬å¯¹ `#commit(TransactionStatus status)` æ–¹æ³•çš„è§£é‡Šã€‚é€šè¿‡è¯¥æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥åˆ¤æ–­ï¼Œå½“å‰äº‹åŠ¡æ˜¯å¦å½“å‰æ–¹æ³•æ‰€åˆ›å»ºçš„ï¼Œåªæœ‰åˆ›å»ºäº‹åŠ¡çš„æ–¹æ³•ï¼Œ**æ‰èƒ½ä¸”åº”è¯¥çœŸæ­£çš„æäº¤äº‹åŠ¡**ã€‚

## ä½¿ç”¨ Spring äº‹åŠ¡æœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼Ÿ

1. é€šè¿‡ PlatformTransactionManager ï¼Œä¸ºä¸åŒçš„æ•°æ®å±‚æŒä¹…æ¡†æ¶æä¾›ç»Ÿä¸€çš„ API ï¼Œæ— éœ€å…³å¿ƒåˆ°åº•æ˜¯åŸç”Ÿ JDBCã€Spring JDBCã€JPAã€Hibernate è¿˜æ˜¯ MyBatis ã€‚
2. é€šè¿‡ä½¿ç”¨å£°æ˜å¼äº‹åŠ¡ï¼Œä½¿ä¸šåŠ¡ä»£ç å’Œäº‹åŠ¡ç®¡ç†çš„é€»è¾‘åˆ†ç¦»ï¼Œæ›´åŠ æ¸…æ™°ã€‚

ä»å€¾å‘ä¸Šæ¥è¯´ï¼Œè‰¿è‰¿æ¯”è¾ƒå–œæ¬¢**æ³¨è§£** + å£°æ˜å¼äº‹åŠ¡ã€‚

# Spring Data Access

> è‰¿è‰¿ï¼šè¿™å—çš„é—®é¢˜ï¼Œæ„Ÿè§‰é¢è¯•é—®çš„ä¸å¤šï¼Œè‡³å°‘æˆ‘å¾ˆå°‘é—®ã€‚å“ˆå“ˆå“ˆã€‚å°±å½“åšä¸‹äº†è§£ï¼Œä¸‡ä¸€é—®äº†å‘¢ã€‚

## Spring æ”¯æŒå“ªäº› ORM æ¡†æ¶ï¼Ÿ

- Hibernate
- JPA
- MyBatis
- [JDO](https://docs.spring.io/spring/docs/3.0.0.M4/reference/html/ch13s04.html)
- [OJB](https://db.apache.org/ojb/docu/howtos/howto-use-spring.html)

å¯èƒ½ä¼šæœ‰èƒ–å‹è¯´ï¼Œä¸æ˜¯åº”è¯¥è¿˜æœ‰ Spring JDBC å—ã€‚æ³¨æ„ï¼ŒSpring JDBC ä¸æ˜¯ ORM æ¡†æ¶ã€‚

## åœ¨ Spring æ¡†æ¶ä¸­å¦‚ä½•æ›´æœ‰æ•ˆåœ°ä½¿ç”¨ JDBC ï¼Ÿ

Spring æä¾›äº† Spring JDBC æ¡†æ¶ï¼Œæ–¹ä¾¿æˆ‘ä»¬ä½¿ç”¨ JDBC ã€‚

å¯¹äºå¼€å‘è€…ï¼Œåªéœ€è¦ä½¿ç”¨ JdbcTemplate ç±»ï¼Œå®ƒæä¾›äº†å¾ˆå¤šä¾¿åˆ©çš„æ–¹æ³•è§£å†³è¯¸å¦‚æŠŠæ•°æ®åº“æ•°æ®è½¬å˜æˆåŸºæœ¬æ•°æ®ç±»å‹æˆ–å¯¹è±¡ï¼Œæ‰§è¡Œå†™å¥½çš„æˆ–å¯è°ƒç”¨çš„æ•°æ®åº“æ“ä½œè¯­å¥ï¼Œæä¾›è‡ªå®šä¹‰çš„æ•°æ®é”™è¯¯å¤„ç†ã€‚

æ²¡æœ‰ä½¿ç”¨è¿‡çš„èƒ–å‹ï¼Œå¯ä»¥çœ‹çœ‹ [ã€ŠSpring JDBC è®¿é—®å…³ç³»å‹æ•°æ®åº“ã€‹](https://www.tianmaying.com/tutorial/spring-jdbc-data-accessing) æ–‡ç« ã€‚

## Spring æ•°æ®æ•°æ®è®¿é—®å±‚æœ‰å“ªäº›å¼‚å¸¸ï¼Ÿ

é€šè¿‡ä½¿ç”¨ Spring æ•°æ®æ•°æ®è®¿é—®å±‚ï¼Œå®ƒç»Ÿä¸€äº†å„ä¸ªæ•°æ®æŒä¹…å±‚æ¡†æ¶çš„ä¸åŒå¼‚å¸¸ï¼Œç»Ÿä¸€è¿›è¡Œæä¾› `org.springframework.dao.DataAccessException` å¼‚å¸¸åŠå…¶å­ç±»ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

[![æµç¨‹å›¾](http://static2.iocoder.cn/images/Spring/2018-12-24/09.jpg)](http://static2.iocoder.cn/images/Spring/2018-12-24/09.jpg)æµç¨‹å›¾

## ä½¿ç”¨ Spring è®¿é—® Hibernate çš„æ–¹æ³•æœ‰å“ªäº›ï¼Ÿ

> è‰¿è‰¿ï¼šè¿™ä¸ªé—®é¢˜å¾ˆçµå¼‚ï¼Œå› ä¸ºè‰¿è‰¿å·²ç»å¥½ä¹…ä¸ä½¿ç”¨ Hibernate äº†ï¼Œæ‰€ä»¥ç­”æ¡ˆæ˜¯ç›´æ¥å¤åˆ¶çš„ã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼ä½¿ç”¨ Spring è®¿é—® Hibernateï¼š

- ä½¿ç”¨ Hibernate æ¨¡æ¿å’Œå›è°ƒè¿›è¡Œæ§åˆ¶åè½¬ã€‚
- æ‰©å±• HibernateDAOSupport å¹¶åº”ç”¨ AOP æ‹¦æˆªå™¨èŠ‚ç‚¹ã€‚

> è‰¿è‰¿ï¼šä¸è¿‡æˆ‘è®°å¾—ï¼Œ12 å¹´æˆ‘ç”¨è¿‡ Spring JPA çš„æ–¹å¼ï¼Œæ“ä½œ Hibernate ã€‚å…·ä½“å¯å‚è€ƒ [ã€Šä¸€èµ·æ¥å­¦ SpringBoot 2.x | ç¬¬å…­ç¯‡ï¼šæ•´åˆ Spring Data JPAã€‹](http://www.iocoder.cn/Spring-Boot/battcn/v2-orm-jpa/) ã€‚

å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥å†æ¥çœ‹ä¸€é“ [ã€ŠJPA è§„èŒƒä¸ ORM æ¡†æ¶ä¹‹é—´çš„å…³ç³»æ˜¯æ€æ ·çš„å‘¢ï¼Ÿã€‹](https://www.cnblogs.com/xiaoheike/p/5150553.html) ã€‚è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘å€’æ˜¯é—®è¿‡é¢è¯•çš„å€™é€‰äººï¼Œå“ˆå“ˆå“ˆå“ˆã€‚











### æ‹¦æˆªå™¨å’Œè¿‡æ»¤å™¨

https://www.cnblogs.com/panxuejun/p/7715917.html

#### IOC

tomcatåœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œç›´æ¥ä¼šå¯åŠ¨ springå®¹å™¨

spring loC, springå®¹å™¨ï¼Œæ ¹æ®Xmé…ç½®ï¼Œæˆ–è€…æ˜¯ä½ çš„æ³¨è§£ï¼Œå»å®ä¾‹åŒ–ä½ çš„ä¸€äº›beanå¯¹è±¡ï¼Œç„¶åæ ¹æ®xmé…ç½®æˆ–è€…æ³¨è§£ï¼Œå»å¯¹beanå¯¹è±¡ä¹‹é—´çš„å¼•ç”¨å…³ç³»ï¼Œå»è¿›è¡Œä¾èµ–æ³¨å…¥ï¼ŒæŸä¸ªbeanä¾èµ–äº†å¦å¤–ä¸€ä¸ªbean

åº•å±‚çš„æ ¸å¿ƒæŠ€æœ¯ï¼Œåå°„ï¼Œä»–ä¼šé€šè¿‡åå°„çš„æŠ€æœ¯ï¼Œç›´æ¥æ ¹æ®ä½ çš„ç±»å»è‡ªå·±æ„å»ºå¯¹åº”çš„å¯¹è±¡å‡ºæ¥ï¼Œç”¨çš„å°±æ˜¯åå°„æŠ€æœ¯spring Iocï¼Œ

ç³»ç»Ÿçš„ç±»ä¸ç±»ä¹‹é—´å½»åº•çš„è§£è€¦åˆç°åœ¨è¿™å¥—æ¯”è¾ƒé«˜å¤§ä¸Šçš„ä¸€ç‚¹ç³»ç»Ÿé‡Œï¼Œæœ‰å‡ åä¸ªç±»éƒ½ä½¿ç”¨äº†@ Resource

#### åå°„

<img src="https://gitee.com//chenchong0817/picture/raw/master/Aaron/20200928202111.png" alt="image-20200928202109635" style="zoom:50%;" />

1. getDeclaredFiled ä»…èƒ½è·å–ç±»æœ¬èº«çš„å±æ€§æˆå‘˜ï¼ˆåŒ…æ‹¬ç§æœ‰ã€å…±æœ‰ã€ä¿æŠ¤ï¼‰ 
2. getField ä»…èƒ½è·å–ç±»(åŠå…¶çˆ¶ç±»å¯ä»¥è‡ªå·±æµ‹è¯•) publicå±æ€§æˆå‘˜

#### æ³¨è§£æ³¨å…¥

<img src="https://gitee.com//chenchong0817/picture/raw/master/Aaron/20200928202954.png" alt="image-20200928202951915" style="zoom:50%;" />

### ICOå®¹å™¨



![image-20200928204832272](https://gitee.com//chenchong0817/picture/raw/master/Aaron/20200928205135.png)

![image-20200928205153278](https://gitee.com//chenchong0817/picture/raw/master/Aaron/20200928205155.png)

3. ç›‘å¬å™¨æ¨¡å¼

<img src="upload\image-20200928205517338.png" alt="image-20200928205517338" style="zoom:33%;" />

![image-20200928211039519](https://gitee.com//chenchong0817/picture/raw/master/Aaron/20200928211041.png)

- BeanFactoryï¼šæ¨¡æ¿å·¥å‚
- FactoryBeanï¼šä¸ªæ€§åŒ–å®šåˆ¶Bean

#### æ ¸å¿ƒæ–¹æ³•

![image-20200928211433401](https://gitee.com//chenchong0817/picture/raw/master/Aaron/20200928211435.png)





1. å…ˆè¯»å–ç¯å¢ƒå€¼ï¼š

![image-20200928211259988](https://gitee.com//chenchong0817/picture/raw/master/Aaron/20200928211303.png)

2. å†å¾—åˆ°å·¥å‚BeanFactory
3. BeanFactoryPostProcessor
4.  BeanPostProcessorï¼ˆAOPåœ¨è¿™å®ç°ï¼‰
5. äº‹ä»¶ï¼Œè§‚å¯Ÿè€…æ¨¡å¼
6. å¼€å§‹å¯¹è±¡å®ä¾‹åŒ–