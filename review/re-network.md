



# 网络体系结构

## OSI七层体系结构

概念清楚、理论完整，理论上的国际标准

- 应用层
- 表示层
- 会话层
- 传输层
- 网络层
- 数据链路层
- 物理层

## TCP/IP 四层体系结构



事实上的国际标准

自上而下是：

- 应用层：

  - 功能：负责**处理应用程序的逻辑**，比如文件传输，名称查询和网络管理等。

  > HTTP协议：从 **Web 服务器传输超文本到本地浏览器**的传送协议。
  >
  > Telnet协议：基于**23端口**，用于远程登陆。例：xshell
  >
  > FTP协议：基于**21端口**，文件传输协议。例：xftp
  >
  > SMTP邮件**发送**协议：25端口
  >
  > POP3邮件**接收**协议：110端口

- 传输层

  - 功能：提供**应用程序（两台计算机的进程）间**的通信
  - 设备：
  - 协议：

  > - TCP：
  >   - 传输层通信协议
  >   - 面向连接、点对点、可靠、双工通信、面向字节流
  >   - 对应应用层协议
  >     - FTP
  >     - Telnet
  >     - SMTP
  >     - POP3
  >     - HTTP 
  > - UDP

- 网络层

  -  功能：负责相邻计算机之间的通信，数据包的选路和转发。

  - 设备：路由器

  - 协议：

    > IP（IPV4/IPV6）
    >
    > - ARP协议、RARP协议：
    >
    > - ICMP协议（Ping/Traceroute命令）

- 数据链路层

  - 功能：发送和接收 IP数据报、ARP请求或应答、ARP请求或应答。

  - 设备：网线、网桥、集线器、交换机

  - 协议：

    > PPP：在同一条**物理链路**上进行**点对点**的数据传输协议

### 数据交换设备

- **网关**（应用层、传输层）：
  - 网关在**传输层上以实现网络互连**，是最复杂的网络互连设备，**仅用于两个高层协议不同的网络互连**。
  - 网关的结构也和路由器类似，不同的是互连层。网关**既可以用于广域网互连，也可以用于局域网互连**。
- **路由器**：**路由选择、存储转发**
  - 常见的路由选择协议有：RIP 协议、OSPF 协议。
    - RIP 协议：底层是贝尔曼福特算法，它选择路由的度量标准（metric)是跳数，最大跳数是 15 跳。如果大于 15 跳，它就会丢弃数据包。
    - OSPF 协议：底层是迪杰斯特拉算法，是链路状态路由选择协议，它选择路由的度量标准是带宽，延迟。
- **交换机**：数据链路层、网络层
  - **识别**数据包中的 **MAC 地址**信息，根据 MAC 地址**进行转发**，并将这些 MAC 地址与对应的端口记录在自己内部的一个地址表（**ARP表**）中。
- 网桥：数据链路层
  - 将两个 LAN 连起来，根据 MAC 地址来转发帧。
- 集线器（Hub）：物理层
  - 纯硬件设备，主要用来连接计算机等网络终端。
- 中继器：物理层
  - 在比特级别对网络信号进行再生和重定时，从而使得它们能够在网络上传输更长的距离。

###  **详细说明 Keepalived 的故障切换工作原理？**

这种故障切换，是通过 **VRRP** 协议来实现的。

​    **VRRP** 协议主备故障切换：心跳->故障广播->节点接管->恢复退位



## IP

IP 地址是指**互联网协议地址**，主机的一个**逻辑地址**，以此来**屏蔽物理地址的**差异。

MAC（物理地址）：**我是谁**

- 数据链路层和物理层使用的地址，负责设备间的通信。

IP（逻辑地址）：**我在哪**

- 网络层、网关。跨网络传输

 **ARP 协议**：用于 IP 地址与物理地址的对应。

**RARP 协议**：用于物理地址与 IP 地址的对应。

### ARP 协议工作原理？

- ARP 列表
- ARP请求的广播包: 源主机的IP 地址、硬件地址、以及目的主机的 IP 地址
- 其他主机检查目的主机IP地址
  - 不同忽略
  - 相同
    - 记录
    - 发送ARP请求响应包

### 子网、超网、子网掩码

IP地址根据**子网掩码**被分为独立的**网络地址**和**主机地址**。

子网把大网络分成若干小网络，

超网把一些小网络组合成一个大网络。

### 什么是单播、组播(多播)、广播、任播？

单播：一对一，例：TCP

**组播/多播**：递给一组目的地址

**广播**：广播域中的所有设备

**任播**(anycast):是一种**网络寻址和路由的策略**，使得资料可以根据路由拓朴来决定送到“最近”或“最好”的目的地。

### IPv4 和 IPv6 

**IP地址编址标准**

IPv4：地址长度32位，有限，40亿主机

IPv6：替代IPv4，**长度为 128位**， 2^98 次方倍。

### ICMP 协议

定义：就是互联网**控制**报文协议。

- 控制：网络包在异常负责的网络环境中传输时，会遇到各种问题，当**遇到问题**时，要传出消息，**报告情况**，这样才能调整传输策略。

功能：`IP 主机`、`路由器`之间**传递控制消息**。

- ping
- Traceroute ：用来**侦测主机到目的主机之间所经路由**情况的重要工具，也是最便利的工具。

  - Traceroute 的**原理**：traceroute 发送的是**端口号 >30000**的 **UDP 包**，给目标注解 TTL=1，路由器TTL 减1，直到0，**路由器返回不可达**，主机TTL加1,再发。**目的主机返回的是端口不可达**
    - TTL（生存时间值）TTL是`Time To Live`的缩写，该字段指定IP包被路由器丢弃之前**允许通过的最大网段数量**。

## TCP

### TCP

- 传输层通信协议
- 面向连接
- 点对点
- 可靠
- 双工通信
- 面向字节流

### TCP 头部

![img](https://camo.githubusercontent.com/137a789143b6c6d8af61e62930b9eda514c10ad1/687474703a2f2f75706c6f61642d696d616765732e6a69616e7368752e696f2f75706c6f61645f696d616765732f323434383735322d613636353239636164633332343032302e6a70673f696d6167654d6f6772322f6175746f2d6f7269656e742f7374726970253743696d61676556696577322f322f772f31323430)

- **源端口号**（Source Port）和**目的端口号**（Destination Port）：**区别主机中的不同进程**
- **序号**（Sequence Number）：表示本报文段中的的第一个数据字节**在整个数据流中的序号**，解决**乱序**问题。
- **确认号**：**发送确认的一端所期望收到的下一个序号**，已成功收到数据**字节序号加1**。解决**不丢包**问题。
- **标志位（TCP Flags）**: `0 / 1`
  - **URG**：此标志表示TCP包的**紧急指针域有效**，用来**保证TCP连接不被中断**
  - **ACK**：此标志表示**应答域有效**
  - **PSH**：**立即传送**给应用程序，而**不是在缓冲区中排队**；
  - **RST**：这个标志表示**连接复位请求**。用来*复位那些产生错误的连接，也被用来拒绝错误和非法的数据包*；
  - **SYN**：**表示同步序号，用来建立连接**。SYN标志位和ACK标志位搭配使用。
    - 扫描：SYN的数据包——存在——第一次握手——不安全。
- **Window**:窗口大小，也就是有名的**滑动窗口，用来进行流量控制**；

